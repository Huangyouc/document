强制重新设置
直接在 ~/.bashrc 或 ~/.profile 中重新定义：
echo 'export ANDROID_HOME="$HOME/Android/Sdk"' >> ~/.bashrc
echo 'export PATH="$PATH:$ANDROID_HOME/tools:$ANDROID_HOME/platform-tools"' >> ~/.bashrc
source ~/.bashrc

huangyouchang@huangyouchang:~$ echo $ANDROID_HOME
/opt/sdk


java -version
openjdk version "17.0.6" 2023-01-17
OpenJDK Runtime Environment (build 17.0.6+0-17.0.6b829.9-10027231)
OpenJDK 64-Bit Server VM (build 17.0.6+0-17.0.6b829.9-10027231, mixed mode)

读取java配置的路径：
readlink -f $(which java)
/opt/android-studio/jbr/bin/java

查看系统安装的所有java的路径：
sudo update-alternatives --config java
* 0            /usr/lib/jvm/java-17-openjdk-amd64/bin/java      1711      自动模式
  1            /usr/lib/jvm/java-11-openjdk-amd64/bin/java      1111      手动模式
  2            /usr/lib/jvm/java-17-openjdk-amd64/bin/java      1711      手动模式
  3            /usr/lib/jvm/java-8-openjdk-amd64/jre/bin/java   1081      手动模式

如果 adb操作提示 Operation not permitted

请先 adb root && adb remount，然后再操作

exit 退出当前 adb操作

杀掉这个应用，清掉数据：
adb shell pm clear com.mega.settings
清除的内容:
应用数据 (Data)： 存储在 /data/data/com.mega.settings 目录下的所有本地数据库、Shared Preferences（配置文件）、以及应用私有文件都会被物理删除。
应用缓存 (Cache)： 所有的临时运行缓存会被清空。
权限重置 (Permissions)： 在较新的 Android 版本中，此命令通常会重置该应用已获得的运行时权限。
后台进程： 执行该命令会强制停止（Force Stop）该应用当前运行的所有进程。


unity私有数据目录：
/data/user_de/0/com.mega.carmodel



gitdir=$(git rev-parse --git-dir); scp -p -P 29418 youchang.huang@git.i-tetris.com:hooks/commit-msg ${gitdir}/hooks/
如果报错：
subsystem request failed on channel 0
scp: Connection closed
可以改成：
gitdir=$(git rev-parse --git-dir); scp -O -p -P 29418 youchang.huang@git.i-tetris.com:hooks/commit-msg ${gitdir}/hooks/



注意事项：
权限问题：如果 scp 失败，请检查：
是否已添加服务器的 SSH 公钥到您的 Git 账户
尝试用 curl 手动下载钩子：

bash
curl -Lo .git/hooks/commit-msg http://git.i-tetris.com/tools/hooks/commit-msg
chmod +x .git/hooks/commit-msg
多提交情况：如果是多个提交缺少 Change-Id：

bash
git rebase -i HEAD~2  # 修改最近2个提交（根据实际数量调整）
# 将除第一个提交外的所有行首的 "pick" 改为 "reword"
# 保存退出后会逐个打开编辑器，直接保存关闭即可（触发钩子）
git push origin HEAD:refs/for/master
原理说明：
Gerrit 代码审核系统要求每个提交包含唯一的 Change-Id（形如 I5a9d1748f912345b6a7890c1d2e3f4g5h6i7j8k9l0）。commit-msg 钩子会在提交时自动生成这个标识符插入到提交消息底部。

如果仍有问题，请检查：
钩子是否安装成功（查看 .git/hooks/commit-msg 是否存在）
提交信息末尾是否已包含 Change-Id（使用 git log 查看最新提交）


查看  Settings.Global.putInt 写入的数据：
cd /data/system/users/0 
cat settings_global.xml | grep HICAR



本机刷的e0y，Redwood新增信号后，需要把新增的代码导入到机器里，由王锐 给  android.hardware.automotive.vehicle@2.0-mega-service  和 RedwoodCarService.apk 两个文件：
然后进行导入：
adb root 
adb remount
adb shell

adb push android.hardware.automotive.vehicle@2.0-mega-service /vendor/bin/hw  
adb push RedwoodCarService.apk system/priv-app/RedwoodCarService     
                             
ls -l | grep auto



电脑上如何模拟信号发送进行调试：
使用最新的 CherySomeIP，将板子刷成相应的SOC，准备好 以太网转接盒，
根据read_me 和 多IP设定.docx文档 来配置，第一次要 sudo apt install vlan  
不会的地方请教他人，比如 胡保军，王锐
sudo bash vlan_chery.sh
最后在 someip_case目录下，执行  python3 display_gui.py  即可启动工具。



灯光效果，过滤点击事件，位置灯信号接受，给unity发的消息：
ComboLightPreference: newValue=|light_ctrl

qnx 服务进程过滤：
ps -ef | grep ais_vision_server


向相册本地增加图片：
将图片推到 /sdcard/DCIM/P ，重启即可在相册本地看到这个图

8295 修改字体：
adb shell settings put system font_scale 2.0 

adb shell settings get system font_scale
如果不确定key值：
adb shell settings list global | grep fl_app_permission_state


message:'com.mega.carsettings.provider.slice.panel.parking.power.switch' 过滤出这个slice有没有绑定上

wireshark使用：
sudo wireshark 启动
上面过滤器输入someip.serviceid ==0xa923
可以过滤出来相关服务。

过滤服务id的条件:
someipsd.entry.serviceid==0xa701
过滤出来后，即有Offer，又有Subscribe 和 SubscribeAck，这是一个完整的牵手过程，说明这个服务正常的。


如果wireshark过滤不出来信息，找陈伟帮忙，应该要有件 decode as配置一些信息

wireshark 信息过滤：
someipsd.entry.serviceid==0xA920
可以过滤出 offer  subscribe  subscribleAck
过滤出具体的服务并且能看到发出去的值
ip.addr == 192.168.62.31 && someip.serviceid==0xA920&&someip.payload==01

wireshark no time source destination 这一行的，右键选中pref，可以+一个payload，属性就写someip.payload

使用 someipsd.entry.serviceid==0xA966过滤，如果出来的结果只有offer，没有subscribe的话，说明我们发出去，对方没有订阅，是对方的问题
如果对方没有订阅，使用someip.serviceid==0xA966过滤的结果是空白的。
如果对方订阅了，使用someip.serviceid==0xA966过滤的结果 会有payload的值，paylaod就是我们代码发出去的值。

someipsd.entry.serviceid ==0xa923  someipsd.entry 是用来查看 someip的握手过程
点击offer这一行，查看 SOME/IP Service Discovery Protocol ，展开Entries Array ,会有很多Offer Service,找到我们想要的Service ID，比如 0xa923,展开以后，有个Index,看看是多少行；然后在Options Array 里找到对应的行数，就能看到我们发的是TCP还是UDP

点击Subscribe，相同方式可以看到 对方给我们回的是UDP还是TCp。


应用层使用信号：
// 车门状态
DOOR_FL(EntryLocks.ID_DOOR, FRONT_LEFT),
DOOR_FR(EntryLocks.ID_DOOR, FRONT_RIGHT),
DOOR_RL(EntryLocks.ID_DOOR, REAR_LEFT),
DOOR_RR(EntryLocks.ID_DOOR, REAR_RIGHT),
主驾车门信号检索：
someip.messageid ==0xA4008004
副驾车门信号检索：
someip.messageid ==0xA4018004



someip报文里的payload的数据，就是struct，不要看 里面的length。


运行git remote列出现有的远程，并查看其名称和URL：
git remote -v
输出如下所示内容：
originhttps://github.com/user/repo_name.git (fetch)
originhttps://github.com/user/repo_name.git (push)

使用git remote set-url命令，后跟远程名称和远程URL：
git remote set-url

远程URL可以以HTTPS或SSH开头，具体取决于你使用的协议，如果未指定协议，则默认为SSH，该URL可以在Git托管服务的存储库页面上找到。

例如，要将origin的URL更改为git@gitserver.com:user/repo_name.git，你可以输入：

$ git remote set-url origin git@gitserver.com:user/repo_name.git


reset到远程最新的提交：
git reset --hard mega/release/glacier_hqx.1.2.1_20221021


ubutun安装vim：
sudo apt-get install vim

git修改文本编辑器为vim
git config --global core.editor "vim"


todesk连接上后，进度条卡在100%，就是进不去页面的情况
被控电脑ubuntu:
sudo vim /etc/gdm3/custom.conf   把#WaylandEnable=false前的#号删掉
sudo service gdm3 restart
然后重启电脑


E0X如何在 as的日志里过滤出输入信号：
RedwoodSomeIpProperty
并使用 No Filters


adb pull log 拉的是安卓的log

adb 进cdc-qnx之后，执行reset能重启安卓和qnx


E0X OTA升级包 更新方式：
下载最新的 e0y或者e03的soc的ota包，放在U盘里，u盘插在蓝色的usb中，然后中控选中 升级测试工具 ，会有弹框，选中右下角的DMC，然后选中U盘，
然后选中对应的升级包，拷贝，等进度条跑完，点击确定，可以拔出u盘，后面自动升级。


adb reboot 重启android

查看soc版本号：（可能会改变）
adb shell
telnet cdc-qnx
root
cat /etc/version
输出如下：
VERSION=1.130.144.32812-20230207044856
DEVICE=redwood
VARIANT=userdebug
BRANCH=release_redwood_hqx.1.2.1_20230103
OEM_VERSION=00.01.02.52



ota升级的时候，如果进度条很慢，可能是内存被占用，
adb shell
telnet cdc-qnx
root
slay ic_service
多执行几次 slay ic_service，直到提示  slay: Unable to find process 'ic_service' 表示杀死了这个进程。
这样升级会快点。


电脑交换空间设置：
https://developer.huawei.com/home/forum/hwc/thread-0210178450634573081-1-1.html



查看麦克风是否通了:
adb shell
telnet cdc-qnx
root
logcat -w|grep "M short to ground detected!"
如果显示 1 2 3 4，就表示 1 2 3 4 都没通

麦克风接法：A5接负极，A6接正极。
    


adb root
adb shell
netstat -anp | grep someipd
显示 0.0.0.0:* 的表示someip没连上
显示 192.168.62.3:30501这种形式的，表示连上了。



T1E实车抓日志：
u盘根目录，新建 log.mega.co 文件夹，u盘里不要有升级包之类的东西。
u盘插到车上usb接口，当前软件要处于usb模式。


USER版本开root的方法：
1.telnet cdc-qnx
root
root@mega#cdc!
2.touch persist/enable_dbg
3.reset
关闭android root权限步骤
1.telnet cdc-qnx（输root +密码@mega#cdc!)  密码可能是：Mega#ICC%0630
2.rm persist/enable_dbg
3.reset
大家记得打开了不用的话要关掉，尤其是在客户现场使用尤其注意


遇到：telnet: connect: Message too long
输入：setenforce 0   就行
可能会需要输入密码：
Mega#ICC%0630

user版本使用adb root的时候，弹出弹框：root密码，输入 进入qnx的密码即可，比如：Mega#ICC%0630

E0X_redwood, E0X_kirkwood sop 分支今天(20240702)及之后的 user 版本，进入QNX （串口或 adb shell 里通过 telnet 登录连接）需要输入密码：Mega#ICC%0630

adb root和su命令需要输入密码：Mega#ICC%0630, 自动化台架需要先执行adb shell setprop persist.adb.passwd.verify.enable false
执行adb shell setprop persist.adb.passwd.verify.enable false 取消输入密码


8295 user build 打开 root 的方法：
1. 在 qnx 里面 执行下面的命令
touch /persist/debug/enable_dbg
2. 重启 8295
3. adb shell
4. 执行下面的命令就进入 root
vdbg


1、不接以太网盒子，不会触发心跳重启检测；
2、接了以太网盒子，必须按照以太网物理层配置一个vcc的配置，步骤如下：
sudo ip link set dev 网卡 down
sudo ip link set dev 网卡 address 02:51:52:00:00:07
sudo ip link set dev 网卡 up
sudo ip link add link 网卡 name enx.62 type vlan id 62
sudo ifconfig enx.62 192.168.62.7/24 broadcast 192.168.62.255 up
3、·在qnx禁用vcc检测
touch /persist/disable_vcc
以上三种方式都可以解决这个问题


用这个方式可以通过ADB将log取出去：
拉取到自己电脑指定目录：
adb pull /log '/home/youchanghuang/下载/test/0223/123' 

拉取到自己电脑命令行当前目录：
adb pull /log 



切换到目标目录，过滤这个目录下的日志
zgrep "value: 1" *//过滤出所有 包含value: 1 的语句（有空格的情况下，需要用 ""）
或者：
zgrep EHMI_ACADJUST_NOTIFY_AC_REQUEST  *
过滤多个字段：
zgrep -e "CarSettingActivity->onResume" -e "CarSettingActivity->onStop" *

文件中过滤关键字
grep "showWallpaper" -nr ./


过滤出指定包名的进程：
adb shell ps | grep com.mega
杀掉指定进程：
adb shell kill 2499


redwood:/ # ps -ef | grep audio                                                                                                                                                                                                                    
audioserver     412      1 0 00:00:11 ?     00:00:00 android.hardware.automotive.audiocontrol@2.0-service
audioserver     445      1 0 00:00:11 ?     00:00:00 vendor.mega.hardware.audiocontrol@1.0-service
system         3987    354 0 00:00:29 ?     00:00:00 com.mega.qnxaudiomanager
audioserver    9096      1 3 00:07:18 ?     00:00:04 android.hardware.audio.service
audioserver    9097      1 3 00:07:18 ?     00:00:03 audioserver
root           9914   9009 0 00:09:37 pts/1 00:00:00 grep audio
redwood:/ # kill -9 9096  


adb shell am force-stop com.lion.media 可以杀掉这个包名对应的进程


logcat -b
日志等级：（一定要了解这些日志等级的含义）
main system radio events crash default all
system： 系统层面发出来的日志
events：activity切换的日志

日志里有
switch to system 
switch to events
等关键字

switch to crash 
am_proc_died
可以看到崩溃信息

日志里搜索Booting linux，这是第一次开机触发；

开发阶段可以多打印日志，这样上线后可以方便拿日志。



adb shell getevent

输出类似下面这种日志：
add device 1: /dev/input/event2
  name:     "QVM virtio-input (keyboard)"
add device 2: /dev/input/event1
  name:     "QVM virtio-input (touchscreen)"
add device 3: /dev/input/event0

然后点击屏幕，日志输出：
/dev/input/event1: 0001 014a 00000001
/dev/input/event1: 0003 0039 00000000
/dev/input/event1: 0003 0035 0000047e
/dev/input/event1: 0003 0036 000004e5
/dev/input/event1: 0000 0000 00000000
/dev/input/event1: 0003 0039 ffffffff
/dev/input/event1: 0001 014a 00000000
/dev/input/event1: 0000 0000 00000000
如果点击屏幕，没有这种日志输出，就是屏幕的问题；有输出，但是屏幕依然没反应，需要根据日志分析。

或者通过scrcpy虚拟屏，如果虚拟屏可以正常操作，但是实体屏幕不行，就能确定是屏幕的问题。


git push mega HEAD:refs/for/master
报错：
fatal: Service not enabled
fatal: 远程错误：Service not enabled
解决步骤：
git remote -v
mega	ssh://youchang.huang@git-slave-wh.i-tetris.com:29418/apps/gladius/android/chery/e0x/modules (fetch)
mega	ssh://youchang.huang@git-slave-wh.i-tetris.com:29418/apps/gladius/android/chery/e0x/modules (push)

然后改成北京的地址：
git remote set-url mega ssh://youchang.huang@git.i-tetris.com:29418/apps/gladius/android/chery/e0x/modules

注意：有的时候 是origin，需要 把mega改成origin



DMS指的是驾驶员的舱内视觉检测，OMS是指乘客的舱内视觉检测

打开ssh的配置，可以配置北京和武汉的地址：
vi ～/.ssh/config


切换到项目根目录
repo forall -c 

已提交但是未合入的代码，可以通过这个回退多个提交。
git rebase -i HEAD~4


当一个分支A需要 把另一个分支B最近几次提交cp过来的时候，
先确保两个分支都是干净的
git pull --rebase
git checkout B 
git log --oneline -20
8373f3a (HEAD -> master, mega/master, m/master) 二三排模式按键
fee2e1e 信号调整
d5b53f8 空调出风口
e625124 空调吹风和加热
6b0a3a9 智能模式
3ba8a61 二排三排功能
5f5ed6a (mega/mfg/samoa_hqx.1.2.1_20230306) 新增信号,ui调整
f7462b3 删除讯飞语音依赖
7023300 香氛功能
2b97807 后除霜按钮功能
e0af79a 座椅功能代码类型转换异常修复
cdcba86 前后排座椅按摩
0fb7628 (mega/sop/glacier_hqx.1.2.1_20230223, mega/feature/glacier_hqx.1.2.1_20230227, mega/demo/redwood_hqx.1.2.1_20230223, mega/demo/glacier_hqx.1.2.1_20230227, mega/demo/glacier_hqx.1.2.1_20230223) 后排屏座椅位置调节
ff7c36f (mega/release/zion_hqx.1.2.1_20230220, mega/release/glacier_hqx.1.2.1_20230218, mega/dev_hqx.1.2.1) 修复风量按钮滑动不灵
敏
ad634d4 上下左右调节关联吹风模式
f491abd ui按键状态调整
9865fcb 修复bug
7e21294 除霜按钮状态
69e78e3 空调风量滑动偶发断触摸问题
f5ad633 空调风量等按键触发空调开机


然后：git checkout A
git cherry-pick 8373f3a...f7462b3
8373f3a分别是B最后一次提交，8373f3a...7023300就是B比A多的那几次提交

然后 git status 检查一下本地可以保留，正常情况下，这时候已经提交上去了，然后执行：
git push mega HEAD:refs/for/A
然后在geerit上添加review



remote couldn’t create file: Read-only file system
adb-root
adb disable-verity
adb reboot
adb root
adb remount



在特定目录下，C*表示文件名是C开头的文件，都会被推入这个目录/data/user_de/0/com.mega.cert/cache/
adb push C* /data/user_de/0/com.mega.cert/cache/


删除目录后
rm -rf log
在操作界面，此时log不会生成文件夹，需要adb reboot后再重新操作ui再抓日志


卸载apk：
1、直接执行卸载
1）查看包名：
adb shell pm list packages
2）指定包名卸载：
adb uninstall {包名}

2、获取root权限卸载
方法1一般可能无法卸载，这时就需要获取root权限，删除指定文件下的apk。

1）通过包名获取apk路径（包名地址）：
adb shell pm path {包名}
2）root权限：
adb root
3）读写权限
adb remount
4）删除apk：
adb shell rm {包名地址}
5）重启root：
adb reboot

3、shell卸载
如果2方法还是无法卸载，就只能进入apk目录下进行删除了。
1）获取root权限：
执行2中（2）（3）方法
2）进入shell：
adb shell
3）查看包名：
pm list package
4）获取路径：
pm path {包名}
5）进入apk所在目录
cd /system/app/***
6）彻底删除apk：
rm -rf xxx.apk
7）重启：
reboot


apk重签名：
jarsigner -verbose -keystore XXXXX.keystore -signedjar notepad_signed.apk notepad.apk XXXX.keystore
说明：
1)jarsigner是工具名称，-verbose表示将签名过程中的详细信息打印出来；
2)-keystore XXXXX.keystore 表示签名所使用的数字证书所在位置，没有写路径，表示文件在当前目录；
3)-signedjar notepad_signed.apk notepad.apk 表示给notepad.apk文件签名，签名后的文件名称为notepad_signed.apk；
4)最后面的XXXX.keystore 表示证书的别名，对应于生成数字证书时-alias参数后面的名称（keyAlias）

使用jarsigner对APK重签名，提示：jarsigner: 无法对 jar 进行签名: java.util.zip.ZipException: invalid entry compressed size (expected 41278 but got 42575
bytes) bytes)
最后解决办法是：把要重签名的apk后缀改成zip，打开后删除里面的META-INF目录，然后重新改成apk后缀


网易云音乐的apk，我先把apk push 到vendor/app目录下，重启后，点击这个app会崩溃；但是我直接用 adb install apk 启动这个apk就不会崩溃
解决办法：
按照正常的集成apk的方式，集成到系统中，android.mk和device.mk都配置好，重启个版本，验证ok。


系统集成apk，启动报错：so dlopen，解决方案：https://docs.google.com/document/d/1n2-A9btZv-QZpvyoy91UyVXR7fojKRilX2Q34-06CSE/edit?tab=t.0#heading=h.2okknt7574gu



git clone ssh://youchang.huang@git.i-tetris.com:29418/apps/gladius/android/chery/e0x/apk_prebuilts 
apk_prebuilts里的Android.mk文件，
LOCAL_VENDOR_MODULE := true 表示 apk将被放到 vendor 目录；
没有写LOCAL_VENDOR_MODULE 或者 LOCAL_VENDOR_MODULE := false,会把apk放到system

LOCAL_VENDOR_MODULE := true 表示apk将被放到 vendor/pri-app或者system/pri-app下
LOCAL_VENDOR_MODULE不写或者LOCAL_VENDOR_MODULE := false,apk将被放到vendor/app或者system/app下

配置 
LOCAL_PRIVILEGED_MODULE := true  
LOCAL_SYSTEM_EXT_MODULE := true 
可以将apk配置到 /system/system_ext/priv-app 下

还有其他配置可以把apk放到data下。
在Android.mk通过设置LOCAL_CERTIFICATE实现。如：LOCAL_CERTIFICATE := platform即选择platform来签名。
注：预置无源码的apk应用时，很多时候仍然使用原本第三方签名，LOCAL_CERTIFICATE := PRESIGNED。


prebuild mk  文件中配置了LOCAL_VENDOR_MODULE := true，表明app放在vendor目录下，
比如 RedwoodCarController在/vendor/priv-app目录， 则permissions文件目录应该是 这种：vendor/etc/permissions/privapp-permissions-redwood.xml
prebuild mk  文件中没有配置LOCAL_VENDOR_MODULE := true，表明app放在system目录下，


推ic_service步骤：

adb root;adb remount
adb push ic_service /sdcard
adb shell
cp /sdcard/ic_service /ota/ 
telnet cdc-qnx
root
mv /usr/bin/ic_service /usr/bin/ic_service_bak
cp /ota/android/ic_service /usr/bin/
reset

恢复：ic_service
adb shell
telnet cdc-qnx
root
mv /usr/bin/ic_service /usr/bin/ic_service_bad
mv /usr/bin/ic_service_bak /usr/bin/ic_service   
reset 


推ais_vision_server步骤：

adb root;adb remount
adb push ais_vision_server /sdcard
adb shell
cp /sdcard/ais_vision_server /ota/ 
telnet cdc-qnx
root
mv /usr/bin/ais_vision_server /usr/bin/ais_vision_server_bak
cp /ota/android/ais_vision_server /usr/bin/
reset

恢复：ic_service
adb shell
telnet cdc-qnx
root
mv /usr/bin/ic_service /usr/bin/ic_service_bad
mv /usr/bin/ic_service_bak /usr/bin/ic_service   
reset 

查看ic_service进程在不在
ps -e | grep ic_  



anr日志分析流程：

1. watchdog: Blocked in handler on ActivityManager (ActivityManager)
      说明ActivityManager这个线程被blocked了（ActivityManager是system_server的一个线程）

  
2. 查看ActivityManager线程的堆栈状态：
  "ActivityManager" prio=5 tid=15 Blocked
  at com.android.server.am.ActivityManagerService$MainHandler.handleMessage(ActivityManagerService.java:1784)
  - waiting to lock <0x1a4c832a> (a com.android.server.am.ActivityManagerService) held by thread 61
  该线程在等待锁<0x1a4c832a>，这个锁被thread 61所持有
  
3.查看thread 61的堆栈状态：
   "Binder_5" prio=5 tid=61 Native
  at android.app.IActivityController$Stub$Proxy.appCrashed(IActivityController.java:222)
  at com.android.server.am.ActivityManagerService.crashApplication(ActivityManagerService.java:12297)
  - locked <0x1a4c832a> (a com.android.server.am.ActivityManagerService)
  at com.android.server.am.ActivityManagerService.handleApplicationCrashInner(ActivityManagerService.java:11838)
  at com.android.server.am.ActivityManagerService.handleApplicationCrash(ActivityManagerService.java:11820)
  这里可以看到tid=61的线程是AMS中的一个binder线程，而这个binder线程正在处理app crash，即在crashApplication方法中。由于
  当前处于monkey测试状态，所以会进入ActivityController的appCrashed方法。大致猜测可能是monkey进程的appCrashed被blocked住了，所以
  AMS的crashApplication方法也被blocked住了。
  
4，下面看一下monkey进程，搜一下“appCrashed”关键字，有如下log：
    "Binder_3" prio=5 tid=13 Blocked
  at com.android.commands.monkey.Monkey$ActivityController.appCrashed(Monkey.java:330)
  - waiting to lock <0x12a7bb9b> (a com.android.commands.monkey.Monkey) held by thread 1
  at android.app.IActivityController$Stub.onTransact(IActivityController.java:92)
  at android.os.Binder.execTransact(Binder.java:446)
   果不其然，appCrashed方法在等待锁<0x12a7bb9b>，而这个锁被thread 1锁持有。
   
5.看一下thread 1：
   "main" prio=5 tid=1 Native
  at libcore.io.BlockGuardOs.read(BlockGuardOs.java:230)
  at libcore.io.IoBridge.read(IoBridge.java:512)
  at java.io.FileInputStream.read(FileInputStream.java:177)
  at java.io.InputStreamReader.read(InputStreamReader.java:231)
  - locked <@addr=0x12c518a0> (a java.lang.ProcessManager$ProcessInputStream)
  at java.io.BufferedReader.fillBuf(BufferedReader.java:145)
  at java.io.BufferedReader.readLine(BufferedReader.java:397)
  - locked <@addr=0x12c51ac0> (a java.io.InputStreamReader)
  at com.android.commands.monkey.Monkey.commandLineReport(Monkey.java:458)
  at com.android.commands.monkey.Monkey.getBugreport(Monkey.java:497)
  at com.android.commands.monkey.Monkey.runMonkeyCycles(Monkey.java:1078)
  看到这里我们就明白了，实际上是IO阻塞了。这里可以大致说一下：在monkey测试的时候，当遇到anr\app crash等异常
  情况时，monkey会把这些异常情况写入文件中以供我们分析。monkey在写文件时，是调用“bugreport”这个shell命令来获取当前
  系统各进程的各线程的堆栈情况和状态的，而bugreport会得到大量的信息，所以如果在monkey测试时连续遇到anr/crash，有可能会导致
  这个写文件的过程很长，这样AMS通知monkey的appCrashed的方法就会被blocked住，进而导致AMS被blocked住。
  

注意：如果  "main" p 主线程日志里，没有出现 locked,sleep等线程的生命周期的字样，只出现了MessageQueue，说明是无效trace，这种trace属于发生anr后，没有抓到现场的。
需要分析main log，找到anr，是actvity就往前倒推5秒，分析用户行为，看看能否找到猫腻；是Service就往前倒推10秒；BroadCast就往前倒推20秒看用户行为。

无效trace的例子：
"main" prio=5 tid=1 Native
  | group="main" sCount=1 dsCount=0 flags=1 obj=0x72101338 self=0xb4000074ce1cd010
  | sysTid=3588 nice=-10 cgrp=default sched=0/0 handle=0x7654b374f8
  | state=S schedstat=( 24985187454 4197573928 36117 ) utm=647 stm=1850 core=0 HZ=100
  | stack=0x7fe9052000-0x7fe9054000 stackSize=8192KB
  | held mutexes=
  native: #00 pc 000000000009c0b8  /apex/com.android.runtime/lib64/bionic/libc.so (__epoll_pwait+8)
  native: #01 pc 0000000000019ad0  /system/lib64/libutils.so (android::Looper::pollInner(int)+184)
  native: #02 pc 00000000000199b0  /system/lib64/libutils.so (android::Looper::pollOnce(int, int*, int*, void**)+112)
  native: #03 pc 0000000000110f80  /system/lib64/libandroid_runtime.so (android::android_os_MessageQueue_nativePollOnce(_JNIEnv*, _jobject*, long, int)+44)
  at android.os.MessageQueue.nativePollOnce(Native method)
  at android.os.MessageQueue.next(MessageQueue.java:335)
  at android.os.Looper.loop(Looper.java:183)
  at java.lang.reflect.Method.invoke(Native method)
  at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:596)
  at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:947)


在android/log里，zgrep anr * 过滤出：
logcat.log.086_1970_01_01_08_55_02.gz:01-01 08:54:29.526719   978  2926 I am_anr  : [0,3588,com.android.systemui,818462223,Input dispatching timed out (baa95ee BottomCarSystemBar (server) is not responding. Waited 5003ms for MotionEvent

从日志logcat.log.086_1970_01_01_08_55_02.gz， is not responding  这里往前找秒，发现日志如下：

01-01 08:54:24.118478   269   269 I lowmemorykiller: Reclaimed 0kB, cache(59120kB) and free(12176kB)-reserved(73732kB) below min(73728kB) for oom_adj 0
01-01 08:54:24.118509   269   269 I lowmemorykiller: Suppressed 76 failed kill reports
01-01 08:54:24.184827  2933  2945 V WRSOMEIP: Local: Ping from Client: [0x6872]
--------- switch to events
01-01 08:54:19.163578   407  3035 I liblog  : 59
01-01 08:54:24.279495  1521  1556 I dvm_lock_sample: [com.mega.car,0,MessageProperty,204,MessageQueue.java,337,android.os.Message android.os.MessageQueue.next(),-,600,boolean android.os.MessageQueue.enqueueMessage(android.os.Message, long),40]
--------- switch to main
01-01 08:54:24.668544   442   454 E message_center: onReceive callback already died

很明显，是内存不足。

liblog后面的数字，就是丢失的日志行数

股份项目的逻辑是：
MCU负责接入方控信号，识别按键按下，抬起的状态；
QNX负责判断长按和短按，并封装键值，传给各个模块；
Android和仪表负责接收键值并响应


三方应用调用系统api，可能会调用不到，需要在
AndroidManifest.xml加上  android:sharedUserId="android.uid.system"，配置成系统应用

如果install的应用，和系统中内置的相同包名的应用的sharedUserId不一样，会存在装不上的情况install_failed_shared_user_incompatible
需要先手动卸载 系统里内置的apk
adb shell pm path com.mega.redwoodautolinetest
看下路径在哪里, 然后删除这个路径下的apk;然后确保app签名和系统保持一致


查看当前目录下，各个文件的大小：
du -sh *


adb shell wm density

adb shell wm size

修改设备分辨率：
adb shell wm size 2560x1440
设置density
adb shell wm density 240

seLinux权限问题，需要总结起来


打开终端，直接 history | grep abcd  可以过滤出，以前历史使用的adb命令


如果板子运行软件，无法debug，用cat /etc/version 看下软件是userdebug还是user版本。user版本无法debug。或者重启自己的电脑试试



user 版本需要 install apk 的时候，需要先启动 root 权限。
启用 root 权限：
进入 qnx，touch /persist/enable_dbg 然后重启系统。
重启之后
adb root
adb shell setprop sys.config.app_install_disabled false
adb shell stop
adb shell start
然后就可以 install apk 了



MegaSettings监听值的变化：
   MegaSettings.putIntForUserGlobal(null,"name",0,-1)
        Settings.Global.getUriFor("name");
        mContext.getContentResolver().registerContentObserver(Settings.System.getUriFor(DVR_RECORD_STATE), false, new ContentObserver() {
            @Override
            public void onChange(boolean selfChange) {
                super.onChange(selfChange);
            }



如果有遇到 弹窗需要 毛玻璃效果的，可以考虑继承这个：mega.blur.view.BlurDialog或者 RWBlurDialog


git批量cherry-pick
https://www.cnblogs.com/satire/p/16590170.html

一般系统应用，system或者vendor下面的，都有权限在sdcard里读写。



使用voy_ut工具，写三码数据到板子里：
adb root;adb remount 
adb push voy_ut /sdcard 

adb shell

 cp /sdcard/voy_ut /ota                                                                     
telnet cdc-qnx
login: root

# cp /ota/android/voy_ut /data
# chmod +x /data/voy_ut 

# /data/voy_ut -w sn -p FCOT23#E0300035#   
[VoyTee-UT] : <main> : <212> : parseOpt: 5, 0, 1
# /data/voy_ut -r sn                     
[VoyTee-UT] : <main> : <212> : parseOpt: 6, 0, 1
fn:sn, data:FCOT23#E0300035#
fn:sn, len:16

46 43 4f 54 32 33 23 45 30 33 30 30 30 33 35 23 
# /data/voy_ut -w vin -p E03TEST8155000035
[VoyTee-UT] : <main> : <212> : parseOpt: 5, 0, 1
# /data/voy_ut -r vin                      
[VoyTee-UT] : <main> : <212> : parseOpt: 6, 0, 1
fn:vin, data:E03TEST8155000035
fn:vin, len:17

-w后面是名字  -p 后面是数据

提示一下: 安全存储区的特性：
RPMB没开情况，OTA刷机存在安全存储空间不会被刷掉。qfil和fastboot会刷掉。

RPMB没开情况，写到安全存储区，再开RPMB，安全存储区的数据会丢失！！！

RPMB开启情况下，任何刷机都不会清除安全存储区数据。但无法使用安全启动。

怎么判断安全存储区是否开启？
Qnx侧输入下面指令
QSEEComAPI_Sample -v smplap32 14 1
然后输入2，返回0表示已经开启。

实际体验下来：
sn码写进去重新上下电不会丢失数据
vin码重新上下电，丢失，王峰排查结果是重启时，vin码在mcu被重写了。
张忠毅给出解决方案：
msg_center_test -t uartrpc_svc/uds/req '~!b:0x030x010x000x0f0x010x0e0x800x2e0xf10x90 + 数据
0xf10x90 + 数据内容， 用一个hex表示，比如'1' => 0x31
字符和
进制对照表：https://www.qqxiuzi.cn/bianma/ascii.htm
如果写这个vin:
E03TEST8155000035
msg_center_test -t uartrpc_svc/uds/req '~!b:0x030x010x000x0f0x010x0e0x800x2e0xf10x900x450x300x330x540x450x530x540x380x310x350x350x300x300x300x300x330x35'



和qnx侧新增topic，需要重新打carService推进去，重启后才能生效。


提交apk的，cp到别的分支的时候，如果出现冲突，就要注意 cp过去的apk是否空掉

可以看到分支合入了哪些代码：
branch:release/redwood_hqx.1.2.1_20230410 status:merged


notepad安装
sudo snap install notepad-plus-plus

反编译jar包：
下载工具：
wget https://github.com/java-decompiler/jd-gui/releases/download/v1.6.6/jd-gui-1.6.6.jar
java -jar jd-gui-1.6.6.jar
拖拽目标 JAR 文件到窗口
导出源码：
单文件：右键类名 → Save Source
完整包：File → Save All Sources 导出为 ZIP

这个网站更牛逼，直接托进去jar包，反编译后，下载zip包，解压即可
http://www.javadecompilers.com/


警告：您正丢下1个提交未和任何分支关联：
git branch  <新分支名> 41250fc
通过这个命令行来创建新分支，并把这次提交上去。
然后切换到你想提交的分支，执行 git cherry-pick 41250fc   
然后在git push


使用gitkraken打开一个git仓库，提示：
cannot be opened,because it is a shallow repo
解决方案：
当前app项目根目录下：
git fetch --unshallow




系统冷启动，Luncher被拉起来，
后续Launcher自己异常死掉也会被拉起来，
这两种情况下的进程被拉活，有办法区分出来么？
用一个非persist的property，进程起来就写一个值，如果系统重启这个值是空的，如果app进程重启，这个值非空
sys.debug.bq.logs  类似这样的，只要不是persist开头就行
比如：
String oldTimeString = MegaSystemProperties.get("sys.debug.empty_fl30_activity", "0");
   如果oldTimeString是默认值0,说明是重启了
   重启拉活后，设置MegaSystemProperties.set("sys.debug.empty_fl30_activity", String.valueOf(currentTime));
   后续app自己死掉再起来，读取MegaSystemProperties.get("sys.debug.empty_fl30_activity", "0");的值不会是0
   至于重启第一次读取是0.



版本 = 仪表+安卓APP+平台
主线版本= master仪表 + master安卓 + dev_hqx.4.5.5平台
1206版本= master仪表 + master安卓 + sop/rocky 1206平台



android5.0以后不允许隐示启动servcie或广播，必须指定service类名。


设置具体日期的0点：
adb root && adb shell date "2024-08-01 12:00:00"
adb shell date -s "20240801.120000"




adb exec-out cmd overlay enable com.mega.btphone.bright
在蓝牙界面，可以看到能切换主题成功。说明配置的overlay.apk没问题。


huangyouchang@huangyouchang:~$ uname -m
x86_64

查看apk签名：
keytool -printcert -jarfile RedwoodSystemUI.apk

使用以下命令查看APK签名：(只能看v1签名)
jarsigner -verify -verbose -certs app-release.apk
有v2签名的，可以用这个：
apksigner verify -v --print-certs xxx.apk 

adb shell
md5sum 某个文件，可以查看其md5值




工程模式写入avm，会导致外置功放的配置失效
解决方案：Qnx 输入这个命令后重启 ecu_config_utility -c   



过滤日志：
adb shell logcat | grep AndroidRuntime   

adb shell logcat | grep BCM_MFS_Swt  一定要注意大小写，后面的过滤条件要跟矩阵表的一致。

logcat | grep SomeIp 过滤someip信号

要想信号可以收到连续值，请在topic上做如下配置：
   @PropertyDefine(
            subscribe = "DMS/QnxHealthMessage",
            type = String.class,
            changeMode = CarPropertyConfig.VEHICLE_PROPERTY_CHANGE_MODE_CONTINUOUS
    )


Ubuntu下安装adb和fastboot方法如下：

sudo apt-get update
sudo apt-get install android-tools-adb 
sudo apt-get install android-tools-fastboot


fastboot 模式下快速刷机

$ adb root
$ adb shell
$ telnet cdc-qnx
$ root

执行脚本，进入9008模式(fastboot模式)：
# enter_fastoot_mode.sh
在 /qfi_bin/common/build 目录下执行终端：
python3 fastboot_complete.py --pf=8155_la --st=ufs

上面刷机脚本执行完以后，系统不会自动重启，需要执行reboot命令：
 fastboot reboot
 

https://mastergo.com/
点击右上角的设计文件，
先将底图托进去，然后托第二张图进去，点击第二张图，按数字5,就是50%透明度，可以将底图透出来，可以比对ui



MasterGo
帐号：
youchang.huang@megatronix.co
密码：
Hyc@123456


车模按钮跟随系统按键音：
AudioManager audioManager = (AudioManager) AppGlobals.getInitialApplication()
                    .getSystemService(Context.AUDIO_SERVICE);
            int sound = AudioManager.FX_KEY_CLICK;
            audioManager.playSoundEffect(sound);


这时命令不会立即生效，需要重新打开应用


吸色器：gpick


进程查看：
adb shell ps -e | grep -E "systemui|hvac"


https://coverity.i-tetris.com/query/defects.htm?project=CDC_IFS&cid=12353221
ifshefei
123456


android源码目录：
android/frameworks/base/core/java/android/


https://apps.microsoft.com/store/detail/%E4%B8%B2%E5%8F%A3%E8%B0%83%E8%AF%95%E5%8A%A9%E6%89%8B/9NBLGGH43HDM?hl=zh-cn&gl=cn&cid=ifdef
window下用这个串口工具更好用点


8538使用串口经验：
windows电脑安装 PuTTY软件
使用usb/type c 的线，type c连接上小板，先将usb口和电脑连上，打开电脑的设备管理器，找到端口A，看下是COM多少，比如COM7
然后将小板子查到车机，然后打开putty，选择Serial, Host Name写 COM7，port 填 115200（固定值），然后点Open；
然后打开windows的终端，输入reboot bootloader
然后打开linux电脑，在源码的VENDOR.13.2.9/out/target/product/maple目录下 打开终端，执行./flash_android.sh即可刷android。
成功后可以拉日志，之前起不来的日志也有。

执行：
adb shell setprop persist.vendor.usb.mode host
切换成usb模式。
串口上，在Putty上切换到android：lxc-attach android
然后执行：setprop persist.vendor.usb.mode host 也可以切换成 usb模式

如上使用串口，在Putty上切换到android：lxc-attach android
然后执行：setprop persist.vendor.usb.mode device
就可以切换回adb

串口的命令行下，执行lxc-attach android，就是进入android,可以使用logcat查看android日志



adb shell setprop show.wheel.help 1 给属性show.wheel.help设置值为1 ，之前需要 adb root;adb remount 
adb shell getprop show.wheel.help  返回 1
代码中对应：MegaSystemProperties.getInt("show.wheel.help",0); 
MegaSystemProperties.set("show.wheel.help",1);

adb shell setprop ro.prefix.pkn.name com.mega.chery.controller.
adb shell getprop ro.prefix.pkn.name 会返回 com.mega.chery.controller.

privapp权限增加：
在device仓库下（git clone ssh://git.i-tetris.com:29418/qcom/sa/quic/la/vendor/mega/device/redwood）
privapp-permissions-redwood.xml 文件中添加需要的文件。如果缺失权限，在系统的报错日志里，会给出具体缺哪些权限，缺一个报一个，缺两个会报两个。把日志里缺失的权限都加上

privapp-permissions-redwood.xml这个文件在板子里的目录是：/vendor/etc/permissions/privapp-permissions-redwood.xml

验证方式：adb pull /vendor/etc/permissions/privapp-permissions-redwood.xml，在privapp-permissions-redwood增加需要的权限，然后再推到 /vendor/etc/permissions/。重启验证。


8538的systemui的包在目录：/system_ext/priv-app/CarSystemUI/CarSystemUI.apk
所以私有权限在：/system_ext/etc/permissions/com.android.systemui.xml，其他应用的在 /system/etc/permissions/privapp-permissions-mega-maple.xml
注意systemui应用在system_ext里，所以私有权限也在system_ext/etc/里
#https://git.i-tetris.com/c/qcom/qcm/LA.QSSI.15.0.R2/platform/frameworks/base/+/858285   代码目录在：QSSI.15/frameworks/base/data/etc
8358的systemui权限更改，应该参考：https://git.i-tetris.com/c/qcom/qcm/android/device/mega/maple/+/865541  上面这个不需要改


比如 RedwoodSystemUI 在/system/system_ext/priv-app， 则permissions文件目录应该是 这种：/system/system_ext/etc/permissions/com.android.systemui.xml
也有在在/system/priv-app，则permissions文件目录应该是 这种：/system/etc/permissions/com.android.systemui.xml


地图权限配置：
1.参考 https://git.i-tetris.com/c/qcom/sa/quic/la/vendor/mega/device/samoa/+/146916  照着merge到其它项目
2.雄狮地图是放在 vendor/app目录下（貌似放在其他目录，也是这样配置），在这个文件 sepolicy/seapp_contexts中添加
user=_app seinfo=platform name=com.lion.appfwk.navi domain=platform_app type=app_data_file
3.另外地图应用manifest中需要添加权限android.permission.ACCESS_MAP
4.https://docs.google.com/document/d/10EgW1RqKabQHwh_Vv_VOHrZWLovSPT_d8lgYZ5cLB30/edit
以上流程，由 贺冰 指导。



AA方控的逻辑，都在redwood 0522分支改。
国际的在各个代码的主线分支改；打包是单独的项目，device是从e0x独立出来的。


主题apk安装以后，调用ThemeControl里主题切换方法，可以直接切换；
如果把主题apk拷贝到 vendor/overlay目录下，需要重启后，再调用ThemeControl里主题切换方法才能生效。



如果板子连电脑连不上，做如下排查：
1.确认是adb模式：工程模式中切换或者u盘根目录的.usb脚本
2.确认电源开启前允许的电流大于5A
3.确认电压大于12V小于14V
电压太大/太小或则电流太小，都会导致 adb无法识别。



ubuntu系统使用 sqlite数据库的可视化工具：
自带的软件商店里，搜索DB，安装后，
打开：DB Browser for SQLlite
导出来的数据库需要重命名加下后缀名：.db
使用 DB Browser for SQLlite 打开 这个数据库文件，在浏览数据 里看 数据



下线配置页面都是0的原因，MessageCenterUtil: [ (MessageCenterUtil.java:131)#sendMessage ]send msg, topic=internal_uds/req 发送的请求，但是没有返回；或者返回的都是0



【Ubuntu】解决中文变繁体
系统中文输入法默认成为了繁体中文
解决：输入法切换成中文，然后 ctrl + shift + f
使用上面三个组合键，按一次切换成简体，再按一次成繁体



Android adb获取手机 cpu架构（arm64-v8a 等平台）
adb shell
getprop ro.product.cpu.abi
arm64-v8a


日志中：表示进程启动，1668 就是进程号，通过进程号可以在nodpad++,ctrl+f,find incurrent 找到进程的日志，然后看看进程在哪里停止，就表示进程死亡。
I am_proc_start: [0,1668,1000,com.android.car.settings


主机重启：
PowerManagerService     system_process                       D  reboot, reason = null caller pid: 28276, Caller uid: 1000
可以看到是pid 28276 的进程发起的重启。


外部jira车控筛选器：
(project = RW AND issuetype = Bug AND status not in (Closed, Resolved) AND "Vehicle Model(必填)" in (E03, "All", cascadeOption(none)) AND 史诗链接 != RW-1292 AND labels not in (三无问题) OR project = RW AND issuetype = Bug AND status not in (Closed, Resolved) AND "Vehicle Model(必填)" in (E03, "All", cascadeOption(none)) AND labels is EMPTY) AND priority = "P1->High" AND assignee in (youchang.huang, ningning.qi, bin.xu, xiaolong.zheng, baojun.hu, baocheng.dong) AND created < "2023-08-22 17:00" ORDER BY assignee ASC


刚开始使用滚轮按键监听，需要注意没有使用最新
implementation "mega.core:car:$carVersion"
    implementation project(':cores:car-lib')
    会报下面的错误：
08-30 19:38:50.599  1616  1890 I InputCaptureClientController: [ (InputCaptureClientController.java:731)#dispatchCustomRotaryEvent ]dispatchCustomRotaryEvent CustomRotaryEvent{mInputCode=30, mRotaryTimes=2, mSeq=0, mEventTime=63924}, callback : mega.car.input.ICarInputCallback$Stub$Proxy@f4b4fe3, clientBinder:android.os.BinderProxy@1fa5de0, client pid: 2758
08-30 19:38:50.599  2758  2780 I mega.controlle: oneway function results will be dropped but finished with status UNKNOWN_TRANSACTION and parcel size 0

oneway function results will be dropped but finished with status UNKNOWN_TRANSACTION
需要把报错的进程删掉，然后再试试。
仪表那边可以先不用管，Android侧自己用命令来模拟发滚轮键的信号就行
adb shell 下模拟发命令
左侧滚轮keycode 30 向上滚动2次
msg_center_test -t KeyInput/RotaryEvent {value:{keyCode:30,rotaryTimes:2}}




关于三码：
新下线车子，f18c等需要博泰克去写，写入后就可以读到三码。
t1x 是通过mcu 读取，需要确认e0x是通过mcu读取还是someip信号读取，t1x移植的过来的方式还适用么？

使用陈浩给的真实三码写入方式，去写入三码，试试这个方式能读取到么（此方法不可以外传，我们的测试也不要给）
writeVinSN.sh   脚本里面的vin和sn改一下  然后adb root 之后执行下



adb shell logcat >logcat.log
搜集日志，然后 ctrl + c 停止  
gedit logcat.log 打开这个日志


globalid使用三码生成，三码不变，globalid不会变。如果实车三码没有变化，globalid就不会过期。
globalid过期，是因为三码被占用了，也只会出现在测试场景
使用实车真实三码，不会有这个问题。

vin码在车子下线时 诊断仪写入ECU内，通过 CarPropHelper.getPropertyRaw(Ecu.ID_VIN)读取。

不使用系统签名或者系统配置android:sharedUserId="android.uid.system"，在AndroidManifest.xml 里加权限：

 <uses-permission android:name="mega.car.permission.CAR_POWER" />
    <uses-permission android:name="mega.car.permission.VEHICLE_CONTROL" />
    <uses-permission android:name="android.permission.INTERACT_ACROSS_USERS_FULL" /


使用同一个shareId，系统会认为是相同的应用。
对其中一个做了sd卡权限授权，其他的也就授权了。
麦克风，位置，摄像头 三个权限可以通过开关去打开关闭。


语音问题，可以通过 requestAudioFocus 搜索代码，看看哪里请求了焦点。


install apk报错：
adb: failed to install RedwoodCarSettings.apk: Failure [INSTALL_FAILED_TEST_ONLY: installPackageLI]
解决方法：adb install -r -t test.apk
-r -t的含义：请把这个 APK 安装到手机上；如果已经有了就覆盖安装（并保留数据），即便这个包被标记为了测试版也请允许安装。
还有一个常用的参数是 -d (Downgrade)，它允许你安装一个比当前版本号更低的版本（即“降级安装”）


安装apk遇到：
adb: failed to install RedwoodHvac.apk: Failure [INSTALL_FAILED_INVALID_APK: Package com.mega.redwoodhvac is a persistent app. Persistent apps are not updateable.]
解决方法：
adb shell 
cd vendor/priv-app/RedwoodHvac/
mv RedwoodHvac.apk RedwoodHvac.apk.bk
reboot
然后在执行 install


grep -rn "abcd"  可以从当前目录中过滤出abcd字段。



输入这个命令切换白天黑夜模式：adb shell "su 0 cmd uimode night yes"



livedata有时间限制，dowrite到接收信号回调中间有2秒限制;如果不是和UI相关的，就不应该使用LiveData，而且LiveData短时间内postData会有丢值的问题
AreaLiveDataStore.obtain(ID_MFS_SWITCH_MODE.getId()).observeForever(mObserver);
不使用livedata，可以直接使用 

EntryLocks.ID_DOOR 对应主驾车门信号：BCM_Door_FL  0xA400 8004   A401


VehSettings中的对象，如果是这么使用：
 ID_DMS_DETECT_PERMISSION_SWITCH(Signal.ID_DMS_DETECT_PERMISSION_SWITCH) {
        @Override
        public void write(Object value) {
            Settings.System.putInt(
                    AppGlobals.getInitialApplication().getContentResolver(),
                    SequoiaConstants.KEY_VISION_DETECT_PERMISSION,
                    (int) value);
            super.write(value);
        }

        @Override
        public Object read() {
            int value = Settings.System.getInt(
                    AppGlobals.getInitialApplication().getContentResolver(),
                    SequoiaConstants.KEY_VISION_DETECT_PERMISSION, 0   //默认off
            );
            return value;
        }
    },
其中，Signal.ID_DMS_DETECT_PERMISSION_SWITCH的PropertyDefine属性只有publish，即只有对外发送值的功能，不会接收数据。
 如果使用  AreaLiveDataStore.obtain(ID_DMS_DETECT_PERMISSION_SWITCH).observeForever(this)  这种方式监听数据变化，
只有在ID_DMS_DETECT_PERMISSION_SWITCH.write 写入的时候，收到一次回调；过2s会收到默认0值的回调，因为 CarPropertyLiveData的更新值的逻辑是在写入值的2s后，从carservice读取值，但是当前信号是不接收carservice值的。

这种情况，请使用 ContentObserver的方式监听数据变化，不要监听信号变化。



查看android进程是否起来：
redwood:/ # ps -e | grep auto
audioserver     415      1 12347996  4748 binder_thread_read  0 S android.hardware.automotive.audiocontrol@2.0-service
vehicle_network 416      1 12996180 105380 binder_thread_read 0 S android.hardware.automotive.vehicle@2.0-mega-service
vehicle_network 417      1 12525520  6456 do_epoll_wait       0 S android.hardware.automotive.vehicle@2.0-service
system          460      1 12366308  4624 binder_thread_read  0 S vendor.qti.automotive.qcarcam@1.0-service
system         4562    369 17346288 192272 do_epoll_wait      0 S com.iflytek.autofly.sceneengine
system         4690    369 17021092 129316 do_epoll_wait      0 S com.iflytek.autofly.accountcenter
system         4895    369 16733808 109852 do_epoll_wait      0 S com.iflytek.autofly.platformservice
u0_a30         5065    373 2689032 185612 do_epoll_wait       0 S com.iflytek.autofly.iqiyi



int pdu1H = -16416000;
MLog.d(TAG, "parse pdu1H = " + Integer.toBinaryString(pdu1H));
int data = pdu1H >> 24; //高位补的都是1 
int len = (pdu1H >>> 24) - 1; //高位补的都是0.很多情况下，需要高位补0
MLog.d(TAG, "parse data = " + data);
MLog.d(TAG, "parse data = " + Integer.toBinaryString(data));

 
电源模式对应  d1：on    d2：comfort  d3：off   d4:拔小电瓶   d3对应standby

空调push进去vendor/priv-app/RedwoodHvac/：
adb shell 
cd vendor/priv-app/RedwoodHvac/
mv RedwoodHvac.apk RedwoodHvac.apk.bk
reboot
然后推空调的apk，重启。（要先把你本地这个apk 改个名字）
现在直接push 会unity那个so 找不到的问题
所以改成了install 的方式     起来后 可能要手动点击把进程起起来
install 的 话 相当于是普通app了  进程不会自启 ，调试的是时候第一次启动很慢是正常的




空调语音处理，会有此日志：
 (HvacVoiceManager.java:43)#handlerOperation ]handlerOperation = {"mode":"座椅加热","name":"座椅","mNameValue":{"direct":"+","offset":"3","ref":"ZERO","type":"SPOT"},"operation":"SET","mService":"carControl","mUser":"2"}


出风口角度的调节：跟出风模式关联  自由风可以上下左右调，其他模式只能上下调


拖动出风口，没有发出去信号：
UnityLine: [ (UnityLine.java:567)#ventChange ]tag = 2, h = 69, v = 0
UnityLine.java:718)#syncData ]tag = 0,sH0 = 0, currentH = 4, sV0 = 24, currentV = 87, sCountH0 = 1
UnityLine: [ (UnityLine.java:782)#onShowBar ]onShowBar:false
UnityLine: [ (UnityLine.java:579)#lambda$ventChange$0 ]user operated end cancel

ventChange方法是由unity调用，这个方法里有很多拦截判断，可能是被拦截了。


通过配置字调出车辆设置的驾驶模式：驾驶模式配置字修改成：
E03是10010
E0Y是10001


CarRepairApplication 通过请求 TBoxSignal.TBOX_SYSTEMINFO_SIM_CARD_INFO RR的方法请求返回了ICCID等数据，
给三方提供的方法里 CarInfoControl.getInstance().getIccId()，生产环境里，是通过 VehicleBody.ID_T_BOX_ICCID 信号来获取ICCID。

RR 信号TBoxSignal.TBOX_SYSTEMINFO_SIM_CARD_INFO，在TBoxConverter 里和VehicleBody.ID_T_BOX_ICCID关联起来，
所以只要   CarRepairApplication 或者 TBoxBaseFragment 创建了，就会发RR方法，进而 通过 VehicleBody.ID_T_BOX_ICCID 也能读到 ICCId。

为了防止异常（三码被清掉（VehicleBody.ID_T_BOX_ICCID 在内存中被清掉），但是CarRepairApplication进程又是在的，无法执行CarRepairApplication的onCreate方法，无法发送RR方法），
在CarRepairApplication 请求RR回来的时候，把三码保存到Setting里。
Settings.Global.putString(mContentResolver, "ProVin", mVinNumber);
Settings.Global.putString(mContentResolver, "ProSnNumber", mSnNumber);
 Settings.Global.putString(mContentResolver, "ProHuId", mHuId);
 Settings.Global.putString(mContentResolver, "ProIccId", mIccIdNumber);
 这些码只能用于生产环境。测试环境逻辑保持不变。


RWSwitch 按钮，不要调用setCheck方法，会造成死循环。 调用 setCheckedStatus 



针对10.23号及以后的版本台架自动重启问题：
1、不接以太网盒子，不会触发心跳重启检测；
2、接了以太网盒子，必须按照以太网物理层配置一个vcc的配置，步骤如下：
sudo ip link set dev 网卡 down
sudo ip link set dev 网卡 address 02:51:52:00:00:07
sudo ip link set dev 网卡 up
sudo ip link add link 网卡 name enx.62 type vlan id 62
sudo ifconfig enx.62 192.168.62.7/24 broadcast 192.168.62.255 up
3、·在qnx禁用vcc检测
touch /persist/disable_vcc
以上三种方式都可以解决这个问题




fragmentHost.getFragmentManager().beginTransaction()
                    .add(R.id.mega_havc_bar, mHvacFragment)
                   .commit();
这种方式添加底部 dock栏，在恢复出厂设置第一次进入或者重启的时候，会明显比较慢。根据log，commit后到 fragment执行onCreate方法，可能间隔了六七秒，通过trace文件看，大部分时间浪费在系统创建fragment。
优化方案：抛弃fragment，直接使用view。   


                   
车机序列号即huid的获取方式：通过 Ecu.ID_ECU_SN 读取，不区分测试环境和生产环境。                   

                   
                   
日志过滤  LionMediaSlicePr  可以看到雄狮给额媒体的播放状态



各模块的介绍和架构设计：
https://drive.google.com/drive/u/0/folders/12ZlxxuFww_kOmCjJThnPWkW-mOLS_488         

       
抬头显示的配置字，只有当 配置字=1的时候，hud功能才展示，等于2,是ar抬头显示，目前车子上没有装的，等于2的时候，代码里也不要显示hud功能             



按键日志通过 receive KeyInput/Event过滤看起来正常的，但是通过 Firing events 过滤出来的 日志，没有记录，说明没有应用拦截按键。
01-21 17:23:05.315587  3074  3464 I CarInputManager: [ (CarInputManager.java:100)#lambda$dispatchCustomInputEvent$1 ]Firing events CustomInputEvent{mInputCode=10, mAction=1, mDownTime=13492599, mEventTime=13492703, mRepeatCount=0} on callback u1.e$a@196f154
Firing events过滤出来的日志，说明这个事件被 3074 这个进程消费。
按键分发通过Firing events
过滤出来的日志里，没有雄狮媒体的进程，因为强制分发通道level force，没有打印Firing events，不走 Firing events流程。




内存泄漏分析工具：Android Stuido Profiler
https://zhuanlan.zhihu.com/p/658732427  可以找到谁泄漏了，谁持有了泄漏对象



有时候，内存爆炸，看prof文件，可能看不到泄漏，需要看下哪个对象的数量很多，则这个对象的引用方式有异常，比如http://jira.i-tetris.com/browse/RW-106246


leakcanary查看内存泄漏：
implementation 'com.squareup.leakcanary:leakcanary-android:2.14'
出现泄漏后，杀掉应用进程，点击applist里的Leaks图标可以看到泄漏的信息


预制离线地图的数据 ： 是工厂预制，不是我们干的



mMediaLiveData.observeForever(this::updateMediaData);
这种语法唐造成的泄漏，反注册的时候，找不到。
改成：
 mMediaLiveData.observeForever(mSliceObserver);   

private Observer<Slice> mSliceObserver = new Observer<Slice>() {
        @Override
        public void onChanged(Slice slice) {
            updateMediaData(slice);
        }
    };



问题：处于导航组队，方控控制不了媒体，也控制不了导航组队
因为carplay拦截了焦点，导致系统的 CustomInputEventController收不到方控按键，也就无法分发给导航。媒体判断当前处于导航组队，就不响应了。



重启关键字：Booting
会有如下打印：
Booting Linux on physical CPU 0x0000000000 [0x410fd4c0]
update_verifier: Booting slot 0: isSlotMarkedSuccessful=1
android.hardware.wifi@1.0-service: Wifi Hal is booting up...
ActivityManagerTiming: FinishBooting
SystemServiceRegistry: 	at com.android.server.am.ActivityManagerService.finishBooting(ActivityManagerService.java:5284)
ActivityManager: User 0 state changed from BOOTING to RUNNING_LOCKED


am_proc_died 可以看到死亡进程



单个进程的CPU/内存：
adb shell
top -H -p pid(top 可以看应用的pid)

adb shell top 查看所有CPU/内存


adb shell am dumpheap 包名
然后把文件改成.hprof丢到AS里去看内存泄漏情况

adb shell dumpsys meminfo com.mega.carsettings  查看内存情况   主要看下 TOTAL PSS:
Applications Memory Usage (in Kilobytes):
Uptime: 75224 Realtime: 75224

** MEMINFO in pid 2450 [com.mega.carsettings] **
                   Pss  Private  Private     Swap      Rss     Heap     Heap     Heap
                 Total    Dirty    Clean    Dirty    Total     Size    Alloc     Free
                ------   ------   ------   ------   ------   ------   ------   ------
  Native Heap   122640   122608        0        0   125672   134584   122553     7315
  Dalvik Heap     9122     9060        0        0    13272    19116     9558     9558
 Dalvik Other     6480     4548        0        0     8908                           
        Stack     2396     2396        0        0     2404                           
       Ashmem        4        0        0        0       20                           
    Other dev      126        0      124        0      456                           
     .so mmap    60610    21280    29528        0   116116                           
    .jar mmap     1663        0       64        0    33460                           
    .apk mmap    25985      356    19744        0    61104                           
    .ttf mmap      103        0        0        0      440                           
    .dex mmap       93        4        0        0      388                           
    .oat mmap       27        0        0        0     2224                           
    .art mmap     7990     7784       12        0    20156                           
   Other mmap   283045   124852   156152        0   287856                           
      Unknown    52996    52992        0        0    53616                           
        TOTAL   573280   345880   205624        0   573280   153700   132111    16873
 
 App Summary
                       Pss(KB)                        Rss(KB)
                        ------                         ------
           Java Heap:    16856                          33428
         Native Heap:   122608                         125672
                Code:    71004                         217720
               Stack:     2396                           2404
            Graphics:        0                              0
       Private Other:   338640
              System:    21776
             Unknown:                                  346868
 
           TOTAL PSS:   573280            TOTAL RSS:   726092      TOTAL SWAP (KB):        0
 
 Objects
               Views:      402         ViewRootImpl:        1
         AppContexts:        9           Activities:        2
              Assets:        7        AssetManagers:        0
       Local Binders:      116        Proxy Binders:       79
       Parcel memory:       18         Parcel count:       75
    Death Recipients:       28      OpenSSL Sockets:        0
            WebViews:        0
 
 SQL
         MEMORY_USED:        0
  PAGECACHE_OVERFLOW:        0          MALLOC_SIZE:        0






MegaLinkManager找 罗红杰

如果底层信号有问题或者延迟，问下 CBS张超



视屏中点击副驾车门，结果打开了主驾车门，应该打开副驾车门才对。
从pcap里看到，上报的确实是副驾驶车门开，没有上报主驾车门开。



有E2E保护的someip数据，看最后一位


android seekbar拖动的时候不发送信号：
app:updatesContinuously="false"


adb shell pm grant com.android.systemui android.permission.BLUETOOTH_CONNECT 系统异常导致缺少权限的都可以用这个解决


重启中的日志：
Booting Linux on physical CPU 0x0000000000 [0x51df804e]

通知Launcher启动的日志：
CarControlModel: [ (CarControlModel.java:104)#notifyLauncherReady ]notifyLauncherReady ID_LAUNCHER_READ.



adb shell logcat | grep LogDataInterfaceManager
用我这个可以看ICC是否触发埋点
另外还有：
adb logcat | grep sendToDataPointForCp


此目录里可以找到每次编译的apk
https://jenkins.i-tetris.com/view/mfg/job/redwood_os_mfg/58/execution/node/15/ws/android/vendor/mega/prebuilts/release_apks/redwood/



2023.12.21
车辆设置模块责任人划分：
李宝： 常用 驾驶 车灯 辅助驾驶 unity
周学猛：整车设置 安全设置 环境舒适 抬头显示 车辆状态 
黄有厂：氛围灯，数字钥匙逻辑
车辆设置后面的task都交给合肥做，保军持续支持；有bug或者task过来，按照上述责任人 分配，如果某人名下jira太多，再考虑把单子分配给其他人。
这样做的目的是，一个人固定负责某个模块，代码更熟悉，效率更高。

2025.5.12
车设分工：
周学猛：灯光、车辆设置、服务、显示（HUD部分）、部分快捷tab二级功能
李宝：驾驶、辅助驾驶、大部分快捷tab二级功能
黄有厂：快捷tab一级页面、部分快捷tab二级功能
徐斌/周州：安全、声音、显示（系统设置部分）、连接、语音（应该是雄狮做内容，我们集成）、系统


帧动画对包体积和cpu的影响：
帧动画帧数越多，包体积越大，而且ui给过来的图，不能压缩，不然容易出现水波纹;
帧动画处理控件WindFrameView 的帧数默认一秒30帧，如果改成一秒20帧，cpu可以稍微下降（空调二排从81% 到 78%）
使用全屏的帧动画（2560*1440）cpu占用130%；使用尽可能小的像素（两份2560*1440 改成 1420 * 328  和 480 * 364 ），cpu从 130%降到81%



install apk报错：
adb: failed to install RedwoodCarSettings.apk: Failure [INSTALL_FAILED_TEST_ONLY: installPackageLI]
解决方法：adb install -t test.apk


ssh远程：
ssh matrix@10.57.1.168
密码：matrix

as的 Profiler 无法加载应用时，可以adb root adb remount后试试

当adb链接多个设备是，adb shell要进入其中一个：
adb devices
List of devices attached
emulator-5554 device

$ adb -s emulator-5554 shell

远程拉文件
scp -r matrix@10.57.1.168:~/eric0115/tmp ./localdir
scp -r matrix@10.57.1.168:~/0118/perf_set18.data .


hud模式设置topic：HUD/HUDDisplayMode


通过 TextToSpeechPlayer startSpeaker 过滤语音文案


日志通过 CherySystemUIApplication 过滤出系统版本号
日志通过 string_v 过滤出时间
version name: 可以过滤出部分生态应用初始化时打印的应用的版本号

Binder.getCallingPid() 获取当前方法是哪个跨进程调用的



遇到这种日志：
	Line  44324: 11-13 15:16:21.329886 31834 31834 F DEBUG   : backtrace:
	Line  44329: 11-13 15:16:21.329984 31834 31834 F DEBUG   :       #00 pc 000000000025a56c  /apex/com.android.art/lib64/libart.so (void art::mirror::Object::VisitReferences<true, (art::VerifyObjectFlags)0, (art::ReadBarrierOption)1, art::gc::collector::ConcurrentCopying::ComputeLiveBytesAndMarkRefFieldsVisitor<true>, art::gc::collector::ConcurrentCopying::ComputeLiveBytesAndMarkRefFieldsVisitor<true> >(art::gc::collector::ConcurrentCopying::ComputeLiveBytesAndMarkRefFieldsVisitor<true> const&, art::gc::collector::ConcurrentCopying::ComputeLiveBytesAndMarkRefFieldsVisitor<true> const&)+204) (BuildId: a950457c95408f4686a9668f055842e0)
	Line  44330: 11-13 15:16:21.330005 31834 31834 F DEBUG   :       #01 pc 000000000025a3d4  /apex/com.android.art/lib64/libart.so (art::gc::collector::ConcurrentCopying::AddLiveBytesAndScanRef(art::mirror::Object*)+224) (BuildId: a950457c95408f4686a9668f055842e0)
	Line  44331: 11-13 15:16:21.330019 31834 31834 F DEBUG   :       #02 pc 000000000025bec0  /apex/com.android.art/lib64/libart.so (art::gc::collector::ConcurrentCopying::ProcessMarkStackForMarkingAndComputeLiveBytes()+908) (BuildId: a950457c95408f4686a9668f055842e0)
	Line  44332: 11-13 15:16:21.330044 31834 31834 F DEBUG   :       #03 pc 00000000002540f4  /apex/com.android.art/lib64/libart.so (art::gc::collector::ConcurrentCopying::MarkingPhase()+1204) (BuildId: a950457c95408f4686a9668f055842e0)
	Line  44333: 11-13 15:16:21.330057 31834 31834 F DEBUG   :       #04 pc 00000000002532d8  /apex/com.android.art/lib64/libart.so (art::gc::collector::ConcurrentCopying::RunPhases()+240) (BuildId: a950457c95408f4686a9668f055842e0)


通过检索 DEBUG： 可以找到具体的应用
e  44114: 11-13 15:16:21.226246 31834 31834 F DEBUG   : Build fingerprint: 'Mega/redwood/redwood:11/RQ3A.211001.001/1.2.96.0-20231108:user/release-keys'
	Line  44115: 11-13 15:16:21.226287 31834 31834 F DEBUG   : Revision: '0'
	Line  44116: 11-13 15:16:21.226320 31834 31834 F DEBUG   : ABI: 'arm64'
	Line  44117: 11-13 15:16:21.226827 31834 31834 F DEBUG   : Timestamp: 2023-11-13 15:16:21+0800
	Line  44118: 11-13 15:16:21.226886 31834 31834 F DEBUG   : pid: 12313, tid: 12348, name: HeapTaskDaemon  >>> com.mega.redwoodhvac <<<
	Line  44122: 11-13 15:16:21.226921 31834 31834 F DEBUG   : uid: 1000
	Line  44123: 11-13 15:16:21.226961 31834 31834 F DEBUG   : signal 11 (SIGSEGV), code 1 (SEGV_MAPERR), fault addr 0x44
	Line  44124: 11-13 15:16:21.227005 31834 31834 F DEBUG   : Cause: null pointer dereference
	Line  44125: 11-13 15:16:21.227058 31834 31834 F DEBUG   :     x0  00000000763845c0  x1  0000007806c17a60  x2  0000007806c17a60  x3  0000000000000000
	Line  44126: 11-13 15:16:21.227100 31834 31834 F DEBUG   :     x4  0000000000000010  x5  b4000079191491f0  x6  b4000079d9150820  x7  b4000079d91523f0
	Line  44127: 11-13 15:16:21.227139 31834 31834 F DEBUG   :     x8  0000000000000000  x9  0000000000000001  x10 00000000d6180000  x11 0000000010000000
	Line  44128: 11-13 15:16:21.227183 31834 31834 F DEBUG   :     x12 0000000000000001  x13 000000006fed80a0  x14 0015010d69bb3800  x15 0000000034155555
	Line  44129: 11-13 15:16:21.227288 31834 31834 F DEBUG   :     x16 0000007b5afb97d0  x17 0000007b59d52ad4  x18 0000007805cb2000  x19 0000007806c17a60
	Line  44130: 11-13 15:16:21.227332 31834 31834 F DEBUG   :     x20 00000000763845c0  x21 0000007806c17a60  x22 0000000000000000  x23 b400007989125d08
	Line  44134: 11-13 15:16:21.227372 31834 31834 F DEBUG   :     x24 b40000794914d3b0  x25 0000007806c19000  x26 0000007806c19000  x27 b4000079891259c0
	Line  44135: 11-13 15:16:21.227413 31834 31834 F DEBUG   :     x28 0000007868ff4000  x29 0000007806c17a00
	Line  44136: 11-13 15:16:21.227450 31834 31834 F DEBUG   :     lr  0000007868ba23d8  sp  0000007806c179e0  pc  0000007868ba256c  pst 0000000020000000
	Line  44251: 11-13 15:16:21.275396     0     0 E init    : cannot execv('/system/chery_idps/bin/idps_nodeManager'). See the 'Debugging init' section of init's README.md for tips: Permission denied
	Line  44324: 11-13 15:16:21.329886 31834 31834 F DEBUG   : backtrace:
	Line  44329: 11-13 15:16:21.329984 31834 31834 F DEBUG   :       #00 pc 000000000025a56c  /apex/com.android.art/lib64/libart.so (void art::mirror::Object::VisitReferences<true, (art::VerifyObjectFlags)0, (art::ReadBarrierOption)1, art::gc::collector::ConcurrentCopying::ComputeLiveBytesAndMarkRefFieldsVisitor<true>, art::gc::collector::ConcurrentCopying::ComputeLiveBytesAndMarkRefFieldsVisitor<true> >(art::gc::collector::ConcurrentCopying::ComputeLiveBytesAndMarkRefFieldsVisitor<true> const&, art::gc::collector::ConcurrentCopying::ComputeLiveBytesAndMarkRefFieldsVisitor<true> const&)+204) (BuildId: a950457c95408f4686a9668f055842e0)
	Line  44330: 11-13 15:16:21.330005 31834 31834 F DEBUG   :       #01 pc 000000000025a3d4  /apex/com.android.art/lib64/libart.so (art::gc::collector::ConcurrentCopying::AddLiveBytesAndScanRef(art::mirror::Object*)+224) (BuildId: a950457c95408f4686a9668f055842e0)
	Line  44331: 11-13 15:16:21.330019 31834 31834 F DEBUG   :       #02 pc 000000000025bec0  /apex/com.android.art/lib64/libart.so (art::gc::collector::ConcurrentCopying::ProcessMarkStackForMarkingAndComputeLiveBytes()+908) (BuildId: a950457c95408f4686a9668f055842e0)
	Line  44332: 11-13 15:16:21.330044 31834 31834 F DEBUG   :       #03 pc 00000000002540f4  /apex/com.android.art/lib64/libart.so (art::gc::collector::ConcurrentCopying::MarkingPhase()+1204) (BuildId: a950457c95408f4686a9668f055842e0)
	Line  44333: 11-13 15:16:21.330057 31834 31834 F DEBUG   :       #04 pc 00000000002532d8  /apex/com.android.art/lib64/libart.so (art::gc::collector::ConcurrentCopying::RunPhases()+240) (BuildId: a950457c95408f4686a9668f055842e0)
	
	

测试提的tombstones日志在 device_crash/data/ 
tombstones的单子，要下载 tombstones 日志


可见即可说，没有反应，可以通过日志检索：AppStatusManager 查看viewCmd 里有没有 view的文本
2024-01-03 15:40:43.676  1805-2501  AppStatusManager        com...ytek.cutefly.speechclient.hmi  D  last_status is :{"viewCmd::default":{"data":{"hotInfo":{"viewCmd":"主界面|星途|你好星途|智能模式|扫风|assistNameacwinddriveropen|切至后排|assistNameacpanelrearrow|扫风|assistNameacwindcopilotopen|吹窗|吹脚|吹面|AUTO|自动模式|快速取暖|内外循环|空气净化|前除霜|后除霜|方向盘加热|assistNameacpanelfrontrowventisp|香氛|SYNC|温区同步|OFF|OFF|173****9964|Keyboard|0340|PM|成长进度|设置"}},"activeStatus":"bg","sceneStatus":"default"},"cmd::default":{"data":{},"activeStatus":"fg","sceneStatus":"default"}}

比如喊氛围灯，
讯飞语音会打印 ActionPresenter: performAction() action:Action [type=1004, keyword=氛围灯 
这样的日志。如果没有，说明讯飞语音没过来。



通过adb命令开启GPU过渡绘制调试：

当然，如果每次都进入系统设置嫌麻烦，可以使用adb命令进行开启和关闭：
开启『调试 GPU 过度绘制』：
adb shell setprop debug.hwui.overdraw show
关闭『调试 GPU 过度绘制』：
adb shell setprop debug.hwui.overdraw false
执行命令之后可能需要重新启动你当前开发的应用。
原色：没有过度绘制
蓝色：1 次过度绘制
绿色：2 次过度绘制
粉色：3 次过度绘制
红色：4 次及以上过度绘制



开启音乐律动，AmbLigFlngModSel 这个值肯定是发3 

查看内核版本：
sudo apt list|grep linux-generic*

linux-generic-hwe-18.04-edge/focal-updates,focal-security 5.4.0.169.167 amd64
linux-generic-hwe-18.04/focal-updates,focal-security 5.4.0.169.167 amd64
linux-generic-hwe-20.04-edge/focal-updates,focal-security 5.15.0.91.101~20.04.48 amd64
linux-generic-hwe-20.04/focal-updates,focal-security 5.15.0.91.101~20.04.48 amd64 [可从该版本升级：5.8.0.43.49~20.04.29]
linux-generic/focal-updates,focal-security 5.4.0.169.167 amd64

然后执行 sudo apt-get install linux-generic-hwe-20.04 可以更新内核


     
0y双色氛围灯：1 4 6 9 10     和  3  7 8  12 13 是两种颜色        1 4 6 9 10（上光源） 3  7 8  12 13(下光源)


车机上电，动态氛围灯流程：
开始走迎宾功能：
WELCOME_LIGHT_STEP_1 标志："AmbLigFlngModSel":6
WELCOME_LIGHT_STEP_2 标志 只有 AmbLig14Authn值为1，其他全是0
WELCOME_LIGHT_STEP_3 标志  4 6 7 9 12  14 id为1，亮度100，颜色36
WELCOME_LIGHT_STEP_4 标志  4 6 7 9 12  14 id为1，亮度0，颜色36    
然后恢复氛围灯之前的状态
RESTORE_SAVED_LIGHT_STATUS  



deliverInputEvent to package 排查当前时间点有没有点击事件发到应用



android:importantForAccessibility="noHideDescendants"



给外部提供获取车型的代码：
 int value = Settings.System.getInt(getContentResolver(),
                    "id_config_model_code", 0);
value值含义：
EO3 = 0;
EOY = 1;
EH3 = 2;

1. //这个是开门的开度值，不能作为车门是否打开的判断
ID_DOOR_SET_POSITION_FLL(Signal.ID_DOOR_CURRENT_POSITION, FRONT_LEFT）
ID_DOOR_SET_POSITION_FR(Signal.ID_DOOR_CURRENT_POSITION, FRONT_RIGHT）
ID_DOOR_SET_POSITION_RL
ID_DOOR_SET_POSITION_RR

2.下面这个是用来判断车门运动方向也不能用来判断是否打开关闭：（1 打开方向 2关闭方向）
//电动门开/关按钮状态显示（这个只是用来显示状态）
    ID_DOOR_MOTION_DIRECTION_FL(Signal.ID_DOOR_MOTION_DIRECTION, FRONT_LEFT）
     ID_DOOR_MOTION_DIRECTION_FR(Signal.ID_DOOR_MOTION_DIRECTION, FRONT_RIGHT）
    ID_DOOR_MOTION_DIRECTION_FR(Signal.ID_DOOR_MOTION_DIRECTION, FRONT_RIGHT）
    ID_DOOR_MOTION_DIRECTION_RL(Signal.ID_DOOR_MOTION_DIRECTION, REAR_LEFT）
    （BCM_DoorCtrl_RL_Legacy（0xC83B）notifyMotionDirection.DoorMotionDirection=0x2
BCM_DoorCtrl_RR_Legacy（0xC83C）notifyMotionDirection.DoorMotionDirection=0x2）


3.还有一个门锁信号，没找到文档来源：（个人感觉，判断车门有没有锁上，用这个信号是可以的。因为这个是锁的信号）
A4008004
A4018004
A4028004
A4038004
即
 // 车门锁状态
    DOOR_FL(EntryLocks.ID_DOOR, FRONT_LEFT),

    DOOR_FR(EntryLocks.ID_DOOR, FRONT_RIGHT),

    DOOR_RL(EntryLocks.ID_DOOR, REAR_LEFT),

    DOOR_RR(EntryLocks.ID_DOOR, REAR_RIGHT),
    
    

系统setting属性写入，立刻断电，会出现写入失败的情况。
据说可以通过   Runtime.getRuntime().exec("sync");，强制写入，但是不知道会引起什么未知问题
实车不存在立刻断电的情况，建议不修改。



方控按键模拟：
将脚本 redwood_car_input_test.sh 推到 system/bin
然后执行脚本 adb shell redwood_car_input_test.sh -k 7 -t 300


连接can信号分析的电脑：终端输入：
xfreerdp /u:youchang.huang /p:Aa123456 /dynamic-resolution /v:10.56.1.238


和指令 simpleperf record -g -o /data/local/tmp/perf_vehicle.data --duration 30 -p pid 一起使用，分析cpu


https://mp.weixin.qq.com/s?__biz=MzA5MzI3NjE2MA==&mid=2650263744&idx=1&sn=b67717ba614ebcb64aeaa05a23aa401a&chksm=886321afbf14a8b9ab38b86f913cb975bc0eb609e09be065802d024521b142a97bc71762b67b&scene=27

https://www.jianshu.com/p/f693f9b8c032

Allocations: 此类创建的实例对象数量
Native Size: 此类总共使用的原生内存总量（只有android7.0+设备才能看到）（单位字节）
Shallow Size: 此类使用的java内存总量（单位字节）
Retained Size: 此类实例对象仍存活而保留的内存总大小（单位字节）



抓trace文件分析耗时：
1. 文件目录参考本文件同级目录 perfetto_trace
执行以下命令，开始录制：
adb root && adb remount && adb shell setprop persist.traced.enable 1 && adb push perfetto.pbtxt /data/local/tmp/perfetto.pbtxt && adb shell "rm -rf /data/misc/perfetto-traces/trace" && adb shell "cat /data/local/tmp/perfetto.pbtxt | perfetto --txt -c - -o /data/misc/perfetto-traces/trace"
前提是命令行所在文件夹要有文件：perfetto.pbtxt
默认10s，太长的话会导致trace文件超大
trace录制完后，执行：
adb pull /data/misc/perfetto-traces/trace
可将trace文件导出
2.trace分析
打开https://ui.perfetto.dev/
点击open trace file，将导出的文件打开
加载完就可以看到数据了
点击switch to legacy UI，就可以切换老版本的systrace界面，建议trace文件不要超过65M

停留10s的时间，可以操作ui，也可以不操作
trace文件在浏览器里，按w按键放大，s按键缩小，a按键左移，d按键右移。
鼠标左按键点击拖动，可以看到时间。

去掉按键音：
android:soundEffectsEnabled="false"




飞书 OTA1联调 群：开启宝宝模式，宝宝模式设置的亮度和氛围灯亮度不一样，但是开启宝宝模式后，亮度没有变化
排查结论：
6-2之前那台车之前就是单色氛围灯，所以开宝宝模式亮度都可以调节
8-4这台是因为开的双色氛围灯 所以开宝宝模式只调节了门板的氛围灯亮度
所以非问题，和用户操作的场景有关。


E03方向盘配置字是 电动调节方向盘
E0Y方向盘配置字 才是 转向管柱


e03氛围灯配置：0101
e0y氛围灯配置：0011


氛围灯设置信号id： 0x670000b7



高配地图的uuid读的someip，中配是写入的
中配写入uuid：
写入uuid: 0123456789012345678
msg_center_test -t uartrpc_svc/fact_test/req  '~!b:0x0c0x1e0x010xa00xc40x0f0x140x580x300x310x320x330x340x350x360x370x380x390x300x310x320x330x340x350x360x370x38'

高配中配读的是 自动驾驶控制中心  这个配置字
0是低配，1中中配，2是高配


国际的版本，讯飞语音不支持播放中文。
请在外文模式下测试。
请测试国际版本的同学，提单的时候，务必是在外语的模式下，测出来的bug才能提。在中文模式下的bug，不做数。


ICC接受信号：
0x64228019
根据此信号，ICC 弹出座椅记忆的弹框和消失 座椅记忆的弹框

ICC外发主驾记忆：
0xA9868001

对手件给ICC反馈记忆状态：
0x64228018


冷启动进入车辆设置常用界面，等一会，车模会闪一下，原因：雄狮音乐会预加载，启动了activity，导致车模走了onpause，又onresume



所有使用SwitchCompat控件的界面，可见即可说的设置都需要复写textOn/textOff属性，否则SwitchCompat会默认注册“开启”/“关闭”。 此时用户唤醒后说“开启”“关闭”就会出现可见即可说响应混乱的问题。


- 屏蔽无障碍服务扫描（**频繁刷新控件例如进度条或者非必需响应可见即可说诉求的多层嵌套的控件**，建议从需求导入阶段就拒掉对应的可见即可说的需求，产品定义不需要响应可见即可说的View或者ViewGroup）

  **屏蔽单个控件：android:importantForAccessibility="no"**

  **屏蔽控件及其子控件：android:importantForAccessibility="noHideDescendants"**

- 滑动类型的控件（RecyclerView、ListView、ScrollView、ViewPager）已由助理侧实现了,应用侧不需要关注实现

E0Y PHEV车型，release分支已经拉出来了，0307分支，月底sop，有0y的bug，提到0128的，也需要同步到 0307分支，同时检查下7号开始提到master和0128的，有需要cp到0307的不要遗漏。

android启动后的日志打印：
I SystemServer: Entered the Android system server!


app运行内存，主要是由3d车模和图片消耗。
以0y为例：
正常点击各个tab，车辆设置运行内存占839M，去掉车模和大图，运行内存占用260M。
其中大图占用150M。

大图占用运行内存的逻辑：
E0X全屏尺寸是2560 * 1440的像素，每个像素需要4字节去解析，解析这张图片需要
2560 * 1440 * 4 的字节，也就是14M。
如果车身颜色都可以修改的话，所有的图片都要重新加载一边，内存占用量的增加数，就是每张图片的像素 宽 * 高 * 4，粗略估计，每切换一次颜色，运行内存增加一两百M。

目前E0X车辆设置卡顿的主要原因就是，使用了太多的图片和车模。
如果把这些车模和图片去掉，体验非常流畅。
继续增加图片的使用，只会让车辆设置越来越卡。

    
EOL产线老化测试出现失败，问题分析原则：    
按照EOL日志分析问题原因，显示信号发了但还报错了，优先让对手件去查；
如果判断不出来，可以找我，根据日志确认是不是eol软件本身问题，如果不是，再转对手件。 




原因：
由于车辆设置车模，经常出现车模卡死或者不显示的问题，通过崩溃日志看，基本都有unityMain、signal 11等日志打印。此日志由unity底层打印，应用层无法处理或者监控此类异常。

解决方案：
为了防止此类问题发生时，对用户造成长时间的影响，
车辆设置和unity协商出callbackid的逻辑，即每次android给unity发消息，均携带一个callbackid，15s内如果unity没有给android回复这个callbackid，android这里认为unity出现异常，
然后执行应用退出逻辑。下次应用启动或者用户点击应用，会重新初始化unity，unity即可正常展示。



可以通过 日志 setCurrentSelectTab 过滤出tab对应的顺序
CarSettingSingleUtil: [ (CarSettingSingleUtil.java:107)#setCurrentSelectTab ]unity_change: 　setCurrentSelectTab currentselecttab=3


unity提供的aar包，入库原则：
1.需要unity提供sdk的具体用途，修改了哪些内容
2.拿到unity sdk后，打包apk给unity确认实际效果，开发这边如果发现异常，及时告知unity
3.需要unity确认是否需要提交到仓库里，以及提交到哪些分支，只有得到明确的回复，再提交到仓库。

有人要求提高unity渲染效果的话，先让此人去和cbs谈，愿意给更高内存给到车辆设置的话，unity再提高效果。因为提高效果，必然会占用更高内存。
如果cbs不同意，unity私自调效果，占用更高内存，会导致很多压测bug过来，说内存不足。



翻译表格连接：
如果已经有的string key的文言变动，此key只有自己用的话，就加到连接的对应的月份里；
如果此key已经多出使用，当前修改人需要创建新的key，以满足当前的文言变动需求。并把新key加入到对应的月份里。
https://docs.google.com/spreadsheets/d/1biPtc5cjjC7XozSrOKD7ZBRI6JFbeDdF/edit#gid=730388321

国际翻译文档管理规范：
新增功能或者原有中文文言变动，请使用新的string key。只要改中文string文件，其他string不要添加。同时把新增的string key加到翻译表格的对应的月份里；
相关开发定期同步表格到代码中。如果遇到测试提的需要文本换行的需求，转给黄成，黄成在文本里加上\n 后，我们再同步到代码里。




qnx侧，过滤出gpu使用情况：
echo gpu_perf_governor 1 > /dev/kgsl-control
echo gpu_set_log_level 4 > /dev/kgsl-control
echo gpubusystats 1000 > /dev/kgsl-control
echo gpu_per_process_busy 1000 > /dev/kgsl-control
slog2info -w -b KGSL,kgsl | grep busy


adb 查找文件：
adb shell 'find / -name filename'
替换filename为你要查找的文件名称
找到后会有这种日志：
find: /proc/32538/task/32538/exe: No such file or directory
find: /proc/32538/exe: No such file or directory
/system/etc/carplay/config.xml


rocky:/system # find . -name MegaProperties.jar
./framework/MegaProperties.jar

find -type f -exec grep -l "mega.car_bp" {} \;   这样查找全部文件是否包括mega.car_bp
find -name "*mega.car_bp*"   查找所有文件名字包含 mega.car_bp 的文件



https://git.i-tetris.com/c/qcom/sa/quic/la/vendor/mega/system/debug_tools/+/516431
可以通过download下载提交的jar包

为了解决从后台回到前台，车模闪一下的问题，增加的截图。
视频中有渐变，是截图和车模叠加后，截图逐渐消失引起的。
目前无法解决此问题，且此问题对用户几乎无影响。
不做修改。

AppTaskManager | CarSettingActivity android logcat中过滤多个条件日志



泰维地图往hud上投屏有问题的话，找辛建建或者赵伦


主activity是 android:launchMode="singleInstance"，在此activity启动Bactivity，状态栏切换到其他应用，再状态栏切换到车辆设置，显示Bactivity，b点击返回键，发现不是车辆设置的主页。
原因是singleInstance自己一个activity在一个task中，所以Bactivity在另一个task中。状态来切换显示车辆设置时，拉的是Bactivity所在task，所以没有拉主页所在的task。
鉴于调整主页的launchMode风险太大，决定修改成：Bactivity返回的方法改成启动车辆设置的方式。



关于无效值问题，比如一个开关信号，定义的是1开2关，如果对手件那边上报一个3过来，应该怎么办？（需求：接到无效值按上一帧有效值显示，如果之前没有有效值，显示默认值。）
someip信号里，hal层接到这种无效值，不会上报给应用层，所以应用层显示逻辑符合需求。
can信号里，仪表透传值，按道理应该是仪表处理掉无效值，但是目前各个项目均没有这么做；t28等项目，测试提一个这种无效值，应用层改一个。
can信号的无效值问题，可以仪表改，可以CarService改，也可以应用层改。
实车几乎不会出现这种无效值的情况，目前无效值均是测试人员手动发的无效值，不是实车出现的情况。
综上，只有实车出现这种无效值情况，应用层在做单独处理，测试提出来这种无效值，不做处理。
经过系统以及测试讨论，无效值情况，暂不做测试，实车遇到后，再具体问题具体讨论。



过滤车模相关日志：
removeUnity|hasFocus|addUnity|hide cover|setCurrentSelectTab|MaskView VISIBLE|Unity   : 
CarSettingActivity|UnityControl|driveBgAlpha alpha＝|setCurrentSelectTab

查看onresume和onpause时差：
CarSettingActivity,performPause|CarSettingActivity->onResume
通过AppStarter可以查看状态栏点击启动应用的情况


E0Y:氛围灯为3，才会有动态氛围灯
E03：氛围灯为5，才会有动态氛围灯
且：
E0Y动态氛围灯没有模式切换，E03有模式切换。
所有，只有配置字配程5,且是E03车型，才能测试此功能。



android studio中 settings 搜索plugin，添加 Legacy Layout Inspector,重启后，在顶部Tools里找到Legacy Layout Inspector，选中响应进程，看布局;surfaceview看不到


pwd可以输出当前文件夹完整路径
huangyouchang@huangyouchang:~/ssd2/maple_os/QSSI.15/out/target/product/qssi/system/priv-app/DvTest$ xdg-open .
xdg-open . 可以使用文件打开当前的文件的目录


使用 uiautomatorviewer 查看布局的流程：
1.进入目录：/opt/sdk/tools/bin，找到uiautomatorviewer，使用命令行 pwd可以输出当前文件夹路径
2.进入java目录：/home/huangyouchang/桌面/java8/jdk-8u421-linux-x64/jdk1.8.0_421/bin，拷贝这个目录，
修改 uiautomatorviewer 文件中的java路径：javaCmd="/home/huangyouchang/桌面/java8/jdk-8u421-linux-x64/jdk1.8.0_421/bin/java"
3.在 /opt/sdk/tools/bin目录，命令行执行 uiautomatorviewer，启动ui。
4.adb exec-out screencap -p > 1.png 截图当前android界面
5.adb shell uiautomator dump /sdcard/ui.xml 拉取当前ui的xml
6.adb pull /sdcard/ui.xml 将刚刚拉取的xml文件pull到当前文件夹，并将ui.xml改名为ui.uix
7.第4步中，启动的ui里，选取第5和第6步中的截图和uix
8.ui中可以看到当前视图和布局文件层级关系



8295权限目录：/system/etc/permissions/privapp-permissions-rocky.xml
8295 systemui权限目录：/system/etc/permissions/com.android.systemui.xml


Binder.getCallingPid()获取到进程pid，如果是0，应该是当前的进程。
打印堆栈信息
Thread.dumpStack();

 StackTraceElement[] threads = Thread.currentThread().getStackTrace();
        for (StackTraceElement threadAndStack : threads) {
            MLog.d(TAG, "unregisterListenerBinderForProps 00000" + threadAndStack.toString());
        }
        
mega.car.MegaCarPropHelper#unregisterCallback：
com.mega.car.service.CarPropertyService#unregisterListenerBinderForProps：
 for (StackTraceElement threadAndStack : threads) {
            MLog.d(TAG, "unregisterListenerBinderForProps 00000" + threadAndStack.toString());
        }



REEV BEV仅区分车型是否是纯电还是增程，不作为整车信号通道(CAN信号orSomeip信号)区分
后续CAN信号orSomeip信号区分如下：
5,0架构是走someip的（华为VCC）
5.1架构是走CAN（FLZCU 埃泰克)





2024-10-10 14:13:58.176  2097-2097  UnityWallpaperService   com.mega.carmodel                    D  onCreate()
2024-10-10 14:14:05.113  2097-2480  UnityManager            com.mega.carmodel                    D  unity init end
然后再过1.5s，显示车模

杀进程后unreal起来的日志：
2024-10-10 14:27:34.223  8382-8382  UE4                     com.mega.carmodel                    I  Engine - engine load success
2024-10-10 14:27:36.588  8382-8407  UnityManager            com.mega.carmodel                    D  unity init end

重启车机unreal起来的日志：
2024-10-10 14:30:24.202  2077-2077  UnityWallpaperService   com.mega.carmodel                    D  onCreate()
2024-10-10 14:30:24.561  2077-2077  UE4                     com.mega.carmodel                    I  Engine - engine load success
2024-10-10 14:30:31.332  2077-2480  UnityManager            com.mega.carmodel                    D  unity init end


user版本直接执行adb enable-verity会提示verity cannot be disabled/enabled - USER build
通过touch /persist/debug/enable_dbg方式root后, 执行adb enable-verity就会报图中错误, rm -rf /persist/debug/enable_dbg后重启再次执行adb enable-verity就不会报这个错了



Launcher去掉背景后，有哥默认壁纸，解决方案：
rocky:/vendor/overlay # rm FrameworkCommonrockyRRO.apk，后续考虑删除这个壁纸（不能删，删除后，车模一致处于最上层，其他应用无法打开），所以遇到此问题解决方案目前只有重新刷系统，偶然的。

需要使用系统应用去设置Carmodel为默认壁纸，
先安装LiveWallpapersPicker.apk，
然后，
adb shell am start -n com.android.wallpaper.livepicker/.LiveWallpaperActivity
选中carmodel

Launcher去背景：
 <androidx.viewpager2.widget.ViewPager2
            android:id="@+id/view_pager_wallpaper"
            android:visibility="gone" //这里设置即可
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            launcher:layout_ignoreInsets="true"
            android:overScrollMode="never"
            android:dither="true" />

3D和launcher的2d壁纸的兼容，launcher的配置按照3d来，需要显示2的时候，Launcher中的壁纸view设置visible true，否则设置visible gone。

目前设置visible gone以后，launcher会显示一个默认壁纸

车模准备好以后，在根据3d是否有的配置，来隐藏Launcher中的壁纸view。


Unable to resume activity {com.android.launcher3/com.android.launcher3.Launcher}: android.app.BackgroundServiceStartNotAllowedException: Not allowed to start service Intent { act=ACTION_UNITY cmp=com.mega.carmodel/.UnityWallpaperService (has extras) }: app is in background uid null
因为壁纸服务是特殊服务，只能由系统拉起。
如果他本来就已启动，才能由其他进程拉起

Carmodel目前没有通过systemui启动，所以调试前，需要主动run一下carmodel的工程，运行起来后，才能通过launcher去startservice，否则会报错       BackgroundServiceStartNotAllowedException    


8295目前没有上 healthmanager.xml 白名单策略

//3d和2d切换的配置，和是否支持3d，使用两个配置


是否支持3D桌面，使用：
 Settings.System.putInt(
                AppGlobals.getInitialApplication().getContentResolver(),
                "support_3d_wallpaper", 1);
      int support3d = Settings.System.getInt(getContentResolver(), "support_3d_wallpaper",
                1);
                support3d == 1
                命令行写入：adb shell settings put System support_3d_wallpaper 1
                此support_3d_wallpaper属性一般不用改，改了后要重启才能生效。
此support_3d_wallpaper属性 目前只用于Launcher 和 Carsettings 背景设置透明的代码中使用：
 if (mSupport3d) {
            getWindow().setBackgroundDrawable(new ColorDrawable(Color.TRANSPARENT));
            getWindow().addFlags(WindowManager.LayoutParams.FLAG_SHOW_WALLPAPER);
        } 
以及systemui application的 setWallpaperComponent


车辆设置显示tab，设置3d 和 2d壁纸切换，使用                       
 Settings.System.putInt(
                AppGlobals.getInitialApplication().getContentResolver(),
                "show_3d_wallpaper", 1);
      int show3d = Settings.System.getInt(getContentResolver(), "show_3d_wallpaper",
                1);
                show3d == 1
如果是3d，则Launcher中  mWallpaperViewpager.setVisibility(View.GONE)即2d壁纸view隐藏，否则显示。

所有unity需要的信号，使用VehSetting里的livedata监听，统一监听统一传值给unity。之所以使用livedata，是为了用户操作后立即上报状态给unity，而不用等信号返回才更新状态给unity。
对于部分unity需要实时信号值的需求，再特殊处理。

android:persistent="true"
去掉这个属性后，可以直接install应用。


    sourceSets {
        main {
            java.srcDirs = ['main/src']
            res.srcDirs = ['main/res', 'main/res-e03', 'main/res-e0y']
            aidl.srcDirs = ['main/src']
            assets.srcDirs = ['main/assets']
            manifest.srcFile 'main/AndroidManifest.xml'
        }
        redwood {
            isRedwood = true
            isRocky = false
            java.srcDirs = ['redwood/src']
            res.srcDirs = ['redwood/res-carsettings']
        }
        rocky {
            isRedwood = false
            isRocky = true
            java.srcDirs = ['rocky/src']
            res.srcDirs = ['rocky/res-carsettings']
            manifest.srcFile 'rocky/AndroidManifest.xml'
        }
    }
    
    如果main中AndroidManifest有的配置，rocky 的AndroidManifest中没有，则rocky会集成main，也有这个配置，比如<uses-permission android:name="android.car.permission.CAR_POWER" />


能源管理和导航分屏：
 Bundle bundle = new Bundle();
        bundle.putString("split_enter_main_pkg","com.mega.phev");
        bundle.putString("split_enter_side_pkg","com.lion.appfwk.navi");
        bundle.putString("split_enter_main_act","com.mega.phev.MainActivity");
        bundle.putString("split_enter_side_act","com.lion.appfwk.navi.activity.MainActivity");
        bundle.putBoolean("split_enter_main_is_left", false);
        ContextCompat.getContentResolver().call("com.mega.systemui.chery.Split","enter_spit", "com.mega.phev", bundle);
主activity要加下 ：android:resizeableActivity="true"
activity监听分屏：
 @Override
    public void onMultiWindowModeChanged(boolean isInMultiWindowMode, Configuration newConfig) {
        super.onMultiWindowModeChanged(isInMultiWindowMode, newConfig);
        MLog.i("hyc>>>>>   onMultiWindowModeChanged : " + newConfig);
    }
    


slice查看器 apk下载地址：
https://github.com/android/user-interface-samples/releases/tag/slice-viewer-v1.0.1
然后 adb install -t -r slice-viewer.apk
然后 adb shell am start -a android.intent.action.VIEW -d slice-content://com.mega.carsettings.provider.slice.panel.trunk.switch
可以查看这个slice
如果slice备注了权限 比如android:permission="com.mega.carsettings.export.permission.RedwoodTrunkSlice"，则  slice-viewer.apk 里需要申明权限；或者slice本身删除这个权限


android这边渲染智驾，投到仪表，这快逻辑可以咨询白斌，崔乐天


给cores转bug单，或者需要cores支持的task，公司规定了流程，大家仔细看下文档。
https://docs.google.com/document/d/17zfjWHHIKFBoRdTzU5NZ6mgzFDZ7Idnpiak_qX0SMrw/edit?tab=t.0#heading=h.1z8l8k9ig7e7



大家如果使用slave拉取代码的时候，如果push不上去，提交代码时配置下push url：
git remote set-url --add --push mega ssh://git.i-tetris.com/apps/gladius/android/chery/e0x/RedwoodCarSettings


V25项目，奇瑞uiue稿，https://www.figma.com/
账户：youchang.huang@megatronix.co  密码：Hyc@123456



合肥  设计文档地址  ：
https://drive.google.com/drive/folders/12S7qtNgf60JHaOscDosDSJ0olYSwdmUo



android源码查看网站：
http://aospxref.com/
https://cs.android.com/android
AndroidStudio 卡的话，如果只是为了查代码，用这两个网站就行，

公司自己的查看源码的地址：http://10.58.1.242:8080/source/xref/


使用as打开源码，编译很慢，且无法进行索引，阅读困难
源码android根目录下，集成android.iml  android.ipr   android.iws，修改android.iml中的代码目录；使用as直接打开 android.ipr即可。

另外，单独打开 源码某个工程，可以：
/disk4t/8295_code/android/android$ aidegen vendor/mega/packages/apps/MegaSystemUI frameworks/base/  -i s -p /home/hongjie/tools/android-studio-2025.2.2.7-linux/android-studio/bin



双色氛围灯点击后日志过滤：
mHrgTwoColorLight value = |sendTwoColorSignalSecond|sendTwoColorSignalFirst|doSendSignal mIsLastMusicMode:|write ]ID_AMB_LIGHT_SET:
 
空调车设carmodel三个应用之间切换过滤日志：
onResume consume:|change_view|CarSettingActivity->onResume|onWindowFocusChanged->hasFocus:
方便排查时序


全屏是盖在左右半边屏幕之上的，目前没有显示，所以透出来下面两个半屏，touch默认也是在全屏上，你们那边如果要测试APP功能的话，需要到QNX下执行下面的命令把touch切到两个半屏才能正常点击左右半边的界面
full_win=`cat /dev/screen/0/dpy-2 | grep virtio_input | awk '{print $1}'`;screencmd setiv $full_win zorder 0


 java.lang.NoSuchFieldError: No static field CONFIG_DISPLAY_DIMENSIONS of type Ljava/lang/String; in class Lcom/mega/ecu/MegaProperties; or its superclasses (declaration of 'com.mega.ecu.MegaProperties' appears in /system/framework/MegaProperties.jar



FL车设ue ui问题列举：
1.左右儿童锁和左儿童锁、右儿童锁的交互关系是啥？
1.快捷页面，很多按钮有置灰态，但是ue中未给出置灰条件，比如儿童锁、加油口，开发需要知道什么情况下将此按钮置灰
2.很多按钮未给出回弹时间限制，还是之前的默认2s回弹么？
3.ui上按钮的高亮、置灰、未选中状态，以及个别的按钮的loading状态，对应的icon和动画提供下
4.配置不同导致功能没有时，比如没有加油口、没有车载冰箱的情况下，ui怎么排版。由于一排分配了4个按钮或者3个按钮，所以缺失一个按钮后，后面的按钮无法自动顶上去
5.车载冰箱的信号需要提供
6.快捷按钮上的动画执行，需要有演示效果
7.所有带3d车模的弹框，根据奇瑞杨工的说法，都要改成全屏的，比如 遮阳、车窗页面、车门页面、车身颜色、ISD数字灯
8.驾驶模式切换的时候，3d车模需要展示效果么？
9.驾驶模式个性化页面，动力模式、转向模式等页面，配图使用静态图还是3d车模？
10.灯光中的主题氛围灯和动态氛围灯，选中后的ui需要补全
11.音乐律动开启后，部分氛围灯功能是置灰的，需要在ui上体现
12.电源模式不满足是，部分功能是置灰的，比如辅助驾驶，需要在ui上体现
13.车辆设置中，有个tab按钮叫车辆设置，这会引起语音的歧义：语音说打开车辆设置，是去打开车设app还是打开车设app的这个车辆设置的tab页面呢？




e0x项目，语音功能中间层解析逻辑：
1. 8155 全部车型，都是讯飞接收语音，然后将语义抛给镁佳，镁佳通过RedwoodVoiceRelayService将语义分发给各个应用自己解析，自己做处理，然后自己tts播报
2.8295项目，语音是端到端逻辑：
  1.车设、车控、空调的语音功能，镁佳给讯飞提供端到端sdk，讯飞通过解析语义，调用端到端sdk的接口，实现功能，然后讯飞根据sdk回复的code做tts播报
  2.车况查询和能源管理的端到端接口，使用德赛的方案，镁佳不用单独提供接口给讯飞；讯飞解析语义，通过德赛接口传参数，镁佳通过RedwoodVRService 接收讯飞的参数，然后处理功能，并将回复语ID传给讯飞，
    讯飞做tts播报
  3.8295其他的镁佳模块，各个应用继续使用德赛接口，实现语音功能
3.8295 FL项目，语音的语义解析是雄狮做，镁佳作为语义接收方，逻辑不变。镁佳接收的逻辑，沿用8295的逻辑，即：
  车设、车控、空调的语音功能，镁佳给雄狮提供端到端sdk；雄狮通过解析语义，调用端到端sdk的接口，实现功能，然后雄狮根据sdk回复的code做tts播报
  镁佳其他模块都使用德赛接口实现语音功能：雄狮解析语义后，调用德赛的接口参数，传给镁佳



android aar包能内置到系统中么
https://www.baidu.com/s?ie=utf-8&f=8&rsv_bp=1&rsv_idx=1&tn=baidu&wd=android%20aar%E5%8C%85%E8%83%BD%E5%86%85%E7%BD%AE%E5%88%B0%E7%B3%BB%E7%BB%9F%E4%B8%AD%E4%B9%88&fenlei=256&rsv_pq=0x8cccacb700a6f84e&rsv_t=e09eJ5%2B07MpO2Yl8Ja7J%2BZpzF7RN%2B2C4YfMwwQEBOS%2BqLd6PafI4r4gZP8U&rqlang=en&rsv_dl=tb&rsv_enter=1&rsv_sug3=36&rsv_sug1=33&rsv_sug7=101&rsv_sug2=0&rsv_btype=i&prefixsug=android%2520aar%25E5%258C%2585%25E8%2583%25BD%25E5%2586%2585%25E7%25BD%25AE%25E5%2588%25B0%25E7%25B3%25BB%25E7%25BB%259F%25E4%25B8%25AD%25E4%25B9%2588&rsp=9&inputT=8802&rsv_sug4=10341



查看依赖关系
./../../gradlew -q Redwood:RedwoodSystemUI:dependencies



根目录：./docker/init.sh
cd android/android
source build/envsetup.sh
lunch 12
make RedwoodPermissionGranter
8295_OS_FL/android/android/vendor/mega/packages/apps/RedwoodPermissionGranter




WallpaperService在源码目录：android/android/frameworks/base/core/java/android/service/wallpaper
改完代码，
1. make framework-minus-apex  只所以是这个命令，是因为在frameworks/base/下的Android.bp文件，定义了 name: "framework-minus-apex"
2. adb push \\10.58.1.108\shared_folder\codes\8295-release-0402\android\android\out\target\product\rocky\system\framework\framework.jar /system/framework/
上面的路径，改成你本地的
3. adb shell sync
4. adb reboot

make services
adb push services.jar /system/framework/



gen_minimized_build: saving /home/build/workspace/burn/rocky/burn_images/contents.xml with the updated paths
Done !!!!
pushd /home/build/workspace/qnx/build && cp ota /home/build/workspace/burn/rocky/burn_images/common/build -av
~/workspace/qnx/build ~/workspace
'ota' -> '/home/build/workspace/burn/rocky/burn_images/common/build/ota'
'ota/diffota' -> '/home/build/workspace/burn/rocky/burn_images/common/build/ota/diffota'
'ota/diffota/bsdiff' -> '/home/build/workspace/burn/rocky/burn_images/common/build/ota/diffota/bsdiff'
'ota/diffota/bsdiff4' -> '/home/build/workspace/burn/rocky/burn_images/common/build/ota/diffota/bsdiff4'
'ota/diffota/bsdiff4/core.c' -> '/home/build/workspace/burn/rocky/burn_images/common/build/ota/diffota/bsdiff4/core.c'
'ota/diffota/bsdiff4/format.py' -> '/home/build/workspace/burn/rocky/burn_images/common/build/ota/diffota/bsdiff4/format.py'
'ota/diffota/bsdiff_ota_image.py' -> '/home/build/workspace/burn/rocky/burn_images/common/build/ota/diffota/bsdiff_ota_image.py'
'ota/diffota/bsdiff_otapack.sh' -> '/home/build/workspace/burn/rocky/burn_images/common/build/ota/diffota/bsdiff_otapack.sh'
'ota/diffota/diffconfig.json' -> '/home/build/workspace/burn/rocky/burn_images/common/build/ota/diffota/diffconfig.json'
'ota/diffota/hdiffz' -> '/home/build/workspace/burn/rocky/burn_images/common/build/ota/diffota/hdiffz'
'ota/diffota/libc++.so' -> '/home/build/workspace/burn/rocky/burn_images/common/build/ota/diffota/libc++.so'
'ota/diffota/ota_make_diff_package.py' -> '/home/build/workspace/burn/rocky/burn_images/common/build/ota/diffota/ota_make_diff_package.py'
'ota/fullota' -> '/home/build/workspace/burn/rocky/burn_images/common/build/ota/fullota'
'ota/fullota/ota_pack.sh' -> '/home/build/workspace/burn/rocky/burn_images/common/build/ota/fullota/ota_pack.sh'
'ota/fullota/ota_tar.py' -> '/home/build/workspace/burn/rocky/burn_images/common/build/ota/fullota/ota_tar.py'
'ota/fullota/partition_cfg.json' -> '/home/build/workspace/burn/rocky/burn_images/common/build/ota/fullota/partition_cfg.json'
'ota/fullota/sign_ota_image.py' -> '/home/build/workspace/burn/rocky/burn_images/common/build/ota/fullota/sign_ota_image.py'
'ota/tools' -> '/home/build/workspace/burn/rocky/burn_images/common/build/ota/tools'
'ota/tools/check_sign_ota.sh' -> '/home/build/workspace/burn/rocky/burn_images/common/build/ota/tools/check_sign_ota.sh'
'ota/tools/create_key_tool.sh' -> '/home/build/workspace/burn/rocky/burn_images/common/build/ota/tools/create_key_tool.sh'
'ota/tools/ota_gen_sign.py' -> '/home/build/workspace/burn/rocky/burn_images/common/build/ota/tools/ota_gen_sign.py'
'ota/tools/ota_gen_verify.py' -> '/home/build/workspace/burn/rocky/burn_images/common/build/ota/tools/ota_gen_verify.py'
'ota/tools/ota_make_zip.py' -> '/home/build/workspace/burn/rocky/burn_images/common/build/ota/tools/ota_make_zip.py'
pushd /home/build/workspace/burn/rocky && 7z a burn.7z burn_images
~/workspace/burn/rocky ~/workspace

7-Zip [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21
p7zip Version 16.02 (locale=C,Utf16=off,HugeFiles=on,64 bits,24 CPUs 13th Gen Intel(R) Core(TM) i7-13700 (B0671),ASM,AES-NI)

Scanning the drive:
171 folders, 239 files, 43607055136 bytes (41 GiB)

Creating archive: burn.7z

Items to compress: 410

                                                                               
Files read from disk: 238
Archive size: 18045756547 bytes (17 GiB)
Everything is Ok


编译信息重定向：编译并实时查看进度，同时保存日志到项目根目录的build_log.txt
make android 2>&1 | tee build_log.txt


icar，某个topic 
2025-10-13 23:17:58.032  7905-7908  message_center          vendor.mega.msgcenter-service        D  send:108 DBG topic:ESC/HHC/FaultSts, payload len:9, payload:{value:1}
2025-10-13 23:17:58.038  7905-7913  message_center          vendor.mega.msgcenter-service        D  dispatch_msg:311 DBG dispatch_msg topic:ESC/HHC/FaultSts, payload_len:9, payload:{value:1}
有这个日志，说明分发成功
板子启动后，需要先杀下msgcenter：adb shell killall vendor.mega.msgcenter-service，
然后再使用msgcenter
如果还不通，adb reboot 后adb shell killall vendor.mega.msgcenter-service，再试试


ICar的车设的包名和首页的activity
com.mychery.carsettings
com.mychery.carsettings.MainActivity

过滤 CanManager-setSingleValue:FunctionValue  可以查看车设设置信号



pag动画资源在线预览：
https://pag.io/player.html



公司的自己的网盘地址：
https://mega-disk.megatronix.com/apps/files/?dir=/&fileid=480225  域账号

信号表里的颜色标注：
需要处理的信号统一修改成黄色；
王锐把黄色的信号加入到Carservice以后，会改成绿色；
上层应用开发调用信号，确认没问题，就把颜色去掉。






adb全套命令学习

git 命令学习

repo 命令学习







